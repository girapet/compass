import fs from 'node:fs';

const inputFileName = '../data/wmm/WMM.COF';
const outputFileName = '../js/magnetic-model.js';

let epoch;
let modelName;
let modelDate;
const model = [];

const data = fs.readFileSync(inputFileName, { encoding: 'utf-8' });

data.split('\n').forEach((line) => {
  const values = line.replace(/^\s+|\s+$/g, '').split(/\s+/);

  if (values.length === 3) {
    [ epoch, modelName, modelDate ] = values;
  }
  else if (values.length === 6) {
    const [ n, m, gnm, hnm, dgnm , dhnm ] = values;
    model.push({
      n: parseInt(n, 10),
      m: parseInt(m, 10),
      gnm: parseFloat(gnm),
      hnm: parseFloat(hnm),
      dgnm: parseFloat(dgnm),
      dhnm: parseFloat(dhnm)
    });
  }
});

const json = JSON.stringify({ epoch: parseFloat(epoch), modelName, modelDate, model }, null, 2);

fs.writeFileSync(outputFileName, `// generated by processing/convert-magnetic-model.js, do not edit\n\nexport default ${json};`);
