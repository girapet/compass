{"version":3,"file":"index.js","sources":["../angle.js","../array.js","../geomag.js","../magnetic-model.js","../get-location.js","../3d-rotation-matrix.js","../coordinate-conversion.js","../stereographic-projection.js","../create-transformer.js","../draw-graticule.js","../draw-rotated-text.js","../draw-azimuth.js","../draw-altitude.js","../index.js"],"sourcesContent":["\r\nconst radiansPerDegree = Math.PI / 180;\r\nconst degreesPerRadian = 1 / radiansPerDegree;\r\n\r\nexport const rad = (x) => x * radiansPerDegree;\r\nexport const deg = (x) => x * degreesPerRadian;\r\n\r\nexport const rev = (x) => {\r\n  x = x % 360;\r\n  return x >= 0 ? x : x + 360;\r\n};\r\n\r\nexport default { rad, deg, rev }\r\n\r\n","\r\n// creates a new array of size n filled with value v; the value can also be a function \r\n// that returns a value\r\n\r\nconst array = (n, v) => {\r\n  const a = new Array(n);\r\n\r\n  if (v !== undefined) {\r\n    const isFunction = v instanceof Function;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      a[i] = isFunction ? v() : v;\r\n    }\r\n  }\r\n\r\n  return a;\r\n};\r\n\r\nexport default array;","// adapted from https://github.com/cmweiss/geomagJS/blob/master/geomag.js\r\n// World Magnetic Model: https://www.ncei.noaa.gov/products/world-magnetic-model\r\n\r\nimport magneticModel from './magnetic-model.js';\r\nimport { rad, deg } from './angle.js';\r\nimport array from './array.js';\r\n\r\nconst { sqrt, sin, cos, atan2, abs } = Math;\r\n\r\nconst c = array(13, () => array(13));\r\nconst cd = array(13, () => array(13));\r\nconst tc = array(13, () => array(13));\r\nconst dp = array(13, () => array(13));\r\nconst snorm = array(13, () => array(13));\r\nconst sp = array(13);\r\nconst cp = array(13);\r\nconst fn = array(13);\r\nconst fm = array(13);\r\nconst pp = array(13);\r\nconst k = array(13, () => array(13));\r\nconst p = array(13, () => array(13));\r\n\r\nconst maxord = 12;\r\n\r\nsp[0] = 0;\r\ncp[0] = 1;\r\np[0][0] = 1;\r\npp[0] = 1;\r\ndp[0][0] = 0;\r\n\r\nconst a = 6378.137;\r\nconst b = 6356.7523142;\r\nconst re = 6371.2;\r\nconst a2 = a * a;\r\nconst b2 = b * b;\r\nconst c2 = a2 - b2;\r\nconst a4 = a2 * a2;\r\nconst b4 = b2 * b2;\r\nconst c4 = a4 - b4;\r\n\r\n// read World Magnetic Model spherical harmonic coefficients\r\n\r\nc[0][0] = 0;\r\ncd[0][0] = 0;\r\n\r\nconst { epoch, model } = magneticModel;\r\n\r\nmodel.forEach((coefficients) => {\r\n  const { n, m, gnm, hnm, dgnm , dhnm } = coefficients;\r\n\r\n  if (m <= n) {\r\n    c[m][n] = gnm;\r\n    cd[m][n] = dgnm;\r\n    \r\n    if (m !== 0) {\r\n      c[n][m - 1] = hnm;\r\n      cd[n][m - 1] = dhnm;\r\n    }\r\n  }\r\n});\r\n\r\n// convert Schmidt normalized Gauss coefficients to unnormalized\r\n\r\nsnorm[0][0] = 1;\r\nfm[0] = 0;\r\n\r\nfor (let n = 1; n <= maxord; n++) {\r\n  snorm[0][n] = snorm[0][n - 1] * (2 * n - 1) / n;\r\n  let j = 2;\r\n\r\n  for (let m = 0, D2 = n - m + 1; D2 > 0; D2--, m++) {\r\n    k[m][n] = (((n - 1) * (n - 1)) - (m * m)) / ((2 * n - 1) * (2 * n - 3));\r\n\r\n    if (m > 0) {\r\n      const flnmj = ((n - m + 1) * j) / (n + m);\r\n      snorm[m][n] = snorm[m - 1][n] * sqrt(flnmj);\r\n      j = 1;\r\n      c[n][m - 1] = snorm[m][n] * c[n][m - 1];\r\n      cd[n][m - 1] = snorm[m][n] * cd[n][m - 1];\r\n    }\r\n    c[m][n] = snorm[m][n] * c[m][n];\r\n    cd[m][n] = snorm[m][n] * cd[m][n];\r\n  }\r\n\r\n  fn[n] = n + 1;\r\n  fm[n] = n;\r\n}\r\n\r\nk[1][1] = 0.0;\r\n\r\nconst decimalYear = (date) => {\r\n  date = date || new Date();\r\n  const year = date.getUTCFullYear();\r\n  const daysInYear = 365 + (((year % 400 === 0) || (year % 4 === 0 && (year % 100 > 0))) ? 1 : 0);\r\n  const msInYear = daysInYear * 24 * 60 * 60 * 1000;\r\n  return year + (date.valueOf() - Date.UTC(year, 0)) / msInYear;\r\n};\r\n\r\nconst geomag = (location, date) => {\r\n  const { latitude: glat, longitude: glon, altitude: alt } = location;\r\n  const year = decimalYear(date);\r\n  \r\n  const dt = year - epoch;\r\n  const rlat = rad(glat);\r\n  const rlon = rad(glon);\r\n  const srlon = sin(rlon);\r\n  const srlat = sin(rlat);\r\n  const crlon = cos(rlon);\r\n  const crlat = cos(rlat);\r\n  const srlat2 = srlat * srlat;\r\n  const crlat2 = crlat * crlat;\r\n\r\n  sp[1] = srlon;\r\n  cp[1] = crlon;\r\n\r\n  // convert from geodetic to spherical coordinates\r\n\r\n  const q = sqrt(a2 - c2 * srlat2);\r\n  const q1 = alt * q;\r\n  const q2 = ((q1 + a2) / (q1 + b2)) * ((q1 + a2) / (q1 + b2));\r\n  const ct = srlat / sqrt(q2 * crlat2 + srlat2);\r\n  const st = sqrt(1.0 - (ct * ct));\r\n  const r2 = (alt * alt) + 2.0 * q1 + (a4 - c4 * srlat2) / (q * q);\r\n  const r = sqrt(r2);\r\n  const d = sqrt(a2 * crlat2 + b2 * srlat2);\r\n  const ca = (alt + d) / r;\r\n  const sa = c2 * crlat * srlat / (r * d);\r\n\r\n  for (let m = 2; m <= maxord; m++) {\r\n    sp[m] = sp[1] * cp[m - 1] + cp[1] * sp[m - 1];\r\n    cp[m] = cp[1] * cp[m - 1] - sp[1] * sp[m - 1];\r\n  }\r\n\r\n  const aor = re / r;\r\n  let ar = aor * aor;\r\n  let br = 0;\r\n  let bt = 0;\r\n  let bp = 0;\r\n  let bpp = 0;\r\n\r\n  for (let n = 1; n <= maxord; n++) {\r\n    ar = ar * aor;\r\n    \r\n    for (let m = 0, D4 = n + m + 1; D4 > 0; D4--, m++) {\r\n\r\n      // compute unnormalized associated Legendre polynomials and derivatives via recursion relations\r\n\r\n      if (n === m) {\r\n        p[m][n] = st * p[m - 1][n - 1];\r\n        dp[m][n] = st * dp[m - 1][n - 1] + ct * p[m - 1][n - 1];\r\n      } \r\n      else if (n === 1 && m === 0) {\r\n        p[m][n] = ct * p[m][n - 1];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1];\r\n      } \r\n      else if (n > 1 && n !== m) {\r\n        if (m > n - 2) { \r\n          p[m][n - 2] = 0; \r\n        }\r\n        \r\n        if (m > n - 2) { \r\n          dp[m][n - 2] = 0; \r\n        }\r\n        \r\n        p[m][n] = ct * p[m][n - 1] - k[m][n] * p[m][n - 2];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1] - k[m][n] * dp[m][n - 2];\r\n      }\r\n\r\n      // time adjust the Gauss coefficients\r\n\r\n      tc[m][n] = c[m][n] + dt * cd[m][n];\r\n\r\n      if (m !== 0) {\r\n        tc[n][m - 1] = c[n][m - 1] + dt * cd[n][m - 1];\r\n      }\r\n\r\n      // accumulate terms of the spherical harmonic expansions\r\n\r\n      const par = ar * p[m][n];\r\n      let temp1, temp2;\r\n\r\n      if (m === 0) {\r\n        temp1 = tc[m][n] * cp[m];\r\n        temp2 = tc[m][n] * sp[m];\r\n      } \r\n      else {\r\n        temp1 = tc[m][n] * cp[m] + tc[n][m - 1] * sp[m];\r\n        temp2 = tc[m][n] * sp[m] - tc[n][m - 1] * cp[m];\r\n      }\r\n\r\n      bt = bt - ar * temp1 * dp[m][n];\r\n      bp += fm[m] * temp2 * par;\r\n      br += fn[n] * temp1 * par;\r\n\r\n      // special case: north/south geographic poles\r\n\r\n      if (st === 0 && m === 1) {\r\n        if (n === 1) {\r\n          pp[n] = pp[n - 1];\r\n        } \r\n        else {\r\n          pp[n] = ct * pp[n - 1] - k[m][n] * pp[n - 2];\r\n        }\r\n\r\n        const parp = ar * pp[n];\r\n        bpp += (fm[m] * temp2 * parp);\r\n      }\r\n    }\r\n  }\r\n\r\n  bp = st === 0 ? bpp : bp / st;\r\n\r\n  // rotate magnetic vector components from spherical to geodetic coordinates\r\n\r\n  const bx = -bt * ca - br * sa;\r\n  const by = bp;\r\n  const bz = bt * sa - br * ca;\r\n\r\n  // compute declination (dec), inclination (dip) and total intensity (ti)\r\n\r\n  const bh = sqrt((bx * bx) + (by * by));\r\n  const ti = sqrt((bh * bh) + (bz * bz));\r\n  const dec = deg(atan2(by, bx));\r\n  const dip = deg(atan2(bz, bh));\r\n\r\n  // compute magnetic grid variation if the current geodetic position is in the arctic or antarctic\r\n  // (i.e. glat > +55 degrees or glat < -55 degrees) otherwise, set magnetic grid variation to -999.0\r\n\r\n  let gv = -999;\r\n\r\n  if (abs(glat) >= 55) {\r\n    if (glat > 0 && glon >= 0) {\r\n       gv = dec - glon;\r\n    }\r\n\r\n    if (glat > 0 && glon < 0) {\r\n      gv =  dec + abs(glon);\r\n    }\r\n\r\n    if (glat < 0 && glon >= 0) {\r\n      gv = dec + glon;\r\n    }\r\n\r\n    if (glat < 0 && glon < 0) {\r\n      gv = dec - abs(glon);\r\n    }\r\n\r\n    if (gv > 180) {\r\n      gv -= 360;\r\n    }\r\n\r\n    if (gv < -180) {\r\n      gv += 360;\r\n    }\r\n  }\r\n\r\n  return { declination: dec, inclination: dip, intensity: ti, gridVariation: gv };\r\n};\r\n\r\nexport default geomag;","// generated by processing/convert-magnetic-model.js, do not edit\n\nexport default {\n  \"epoch\": 2025,\n  \"modelName\": \"WMM-2025\",\n  \"modelDate\": \"11/13/2024\",\n  \"model\": [\n    {\n      \"n\": 1,\n      \"m\": 0,\n      \"gnm\": -29351.8,\n      \"hnm\": 0,\n      \"dgnm\": 12,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 1,\n      \"m\": 1,\n      \"gnm\": -1410.8,\n      \"hnm\": 4545.4,\n      \"dgnm\": 9.7,\n      \"dhnm\": -21.5\n    },\n    {\n      \"n\": 2,\n      \"m\": 0,\n      \"gnm\": -2556.6,\n      \"hnm\": 0,\n      \"dgnm\": -11.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 2,\n      \"m\": 1,\n      \"gnm\": 2951.1,\n      \"hnm\": -3133.6,\n      \"dgnm\": -5.2,\n      \"dhnm\": -27.7\n    },\n    {\n      \"n\": 2,\n      \"m\": 2,\n      \"gnm\": 1649.3,\n      \"hnm\": -815.1,\n      \"dgnm\": -8,\n      \"dhnm\": -12.1\n    },\n    {\n      \"n\": 3,\n      \"m\": 0,\n      \"gnm\": 1361,\n      \"hnm\": 0,\n      \"dgnm\": -1.3,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 3,\n      \"m\": 1,\n      \"gnm\": -2404.1,\n      \"hnm\": -56.6,\n      \"dgnm\": -4.2,\n      \"dhnm\": 4\n    },\n    {\n      \"n\": 3,\n      \"m\": 2,\n      \"gnm\": 1243.8,\n      \"hnm\": 237.5,\n      \"dgnm\": 0.4,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 3,\n      \"m\": 3,\n      \"gnm\": 453.6,\n      \"hnm\": -549.5,\n      \"dgnm\": -15.6,\n      \"dhnm\": -4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 0,\n      \"gnm\": 895,\n      \"hnm\": 0,\n      \"dgnm\": -1.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 4,\n      \"m\": 1,\n      \"gnm\": 799.5,\n      \"hnm\": 278.6,\n      \"dgnm\": -2.4,\n      \"dhnm\": -1.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 2,\n      \"gnm\": 55.7,\n      \"hnm\": -133.9,\n      \"dgnm\": -6,\n      \"dhnm\": 4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 3,\n      \"gnm\": -281.1,\n      \"hnm\": 212,\n      \"dgnm\": 5.6,\n      \"dhnm\": 1.6\n    },\n    {\n      \"n\": 4,\n      \"m\": 4,\n      \"gnm\": 12.1,\n      \"hnm\": -375.6,\n      \"dgnm\": -7,\n      \"dhnm\": -4.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 0,\n      \"gnm\": -233.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 5,\n      \"m\": 1,\n      \"gnm\": 368.9,\n      \"hnm\": 45.4,\n      \"dgnm\": 1.4,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 5,\n      \"m\": 2,\n      \"gnm\": 187.2,\n      \"hnm\": 220.2,\n      \"dgnm\": 0,\n      \"dhnm\": 2.2\n    },\n    {\n      \"n\": 5,\n      \"m\": 3,\n      \"gnm\": -138.7,\n      \"hnm\": -122.9,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 4,\n      \"gnm\": -142,\n      \"hnm\": 43,\n      \"dgnm\": 2.2,\n      \"dhnm\": 1.7\n    },\n    {\n      \"n\": 5,\n      \"m\": 5,\n      \"gnm\": 20.9,\n      \"hnm\": 106.1,\n      \"dgnm\": 0.9,\n      \"dhnm\": 1.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 0,\n      \"gnm\": 64.4,\n      \"hnm\": 0,\n      \"dgnm\": -0.2,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 6,\n      \"m\": 1,\n      \"gnm\": 63.8,\n      \"hnm\": -18.4,\n      \"dgnm\": -0.4,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 6,\n      \"m\": 2,\n      \"gnm\": 76.9,\n      \"hnm\": 16.8,\n      \"dgnm\": 0.9,\n      \"dhnm\": -1.6\n    },\n    {\n      \"n\": 6,\n      \"m\": 3,\n      \"gnm\": -115.7,\n      \"hnm\": 48.8,\n      \"dgnm\": 1.2,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 6,\n      \"m\": 4,\n      \"gnm\": -40.9,\n      \"hnm\": -59.8,\n      \"dgnm\": -0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 5,\n      \"gnm\": 14.9,\n      \"hnm\": 10.9,\n      \"dgnm\": 0.3,\n      \"dhnm\": 0.7\n    },\n    {\n      \"n\": 6,\n      \"m\": 6,\n      \"gnm\": -60.7,\n      \"hnm\": 72.7,\n      \"dgnm\": 0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 7,\n      \"m\": 0,\n      \"gnm\": 79.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 1,\n      \"gnm\": -77,\n      \"hnm\": -48.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 2,\n      \"gnm\": -8.8,\n      \"hnm\": -14.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 7,\n      \"m\": 3,\n      \"gnm\": 59.3,\n      \"hnm\": -1,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.8\n    },\n    {\n      \"n\": 7,\n      \"m\": 4,\n      \"gnm\": 15.8,\n      \"hnm\": 23.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 5,\n      \"gnm\": 2.5,\n      \"hnm\": -7.4,\n      \"dgnm\": -0.8,\n      \"dhnm\": -1\n    },\n    {\n      \"n\": 7,\n      \"m\": 6,\n      \"gnm\": -11.1,\n      \"hnm\": -25.1,\n      \"dgnm\": -0.8,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 7,\n      \"gnm\": 14.2,\n      \"hnm\": -2.3,\n      \"dgnm\": 0.8,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 0,\n      \"gnm\": 23.2,\n      \"hnm\": 0,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 8,\n      \"m\": 1,\n      \"gnm\": 10.8,\n      \"hnm\": 7.1,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 2,\n      \"gnm\": -17.5,\n      \"hnm\": -12.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 11.4,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 4,\n      \"gnm\": -21.7,\n      \"hnm\": -9.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 5,\n      \"gnm\": 16.9,\n      \"hnm\": 12.7,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 6,\n      \"gnm\": 15,\n      \"hnm\": 0.7,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.6\n    },\n    {\n      \"n\": 8,\n      \"m\": 7,\n      \"gnm\": -16.8,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 8,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": 3.9,\n      \"dgnm\": 0.2,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 0,\n      \"gnm\": 4.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 9,\n      \"m\": 1,\n      \"gnm\": 7.8,\n      \"hnm\": -24.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 2,\n      \"gnm\": 3,\n      \"hnm\": 12.2,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 3,\n      \"gnm\": -0.2,\n      \"hnm\": 8.3,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 4,\n      \"gnm\": -2.5,\n      \"hnm\": -3.3,\n      \"dgnm\": -0.3,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 5,\n      \"gnm\": -13.1,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 6,\n      \"gnm\": 2.4,\n      \"hnm\": 7.2,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 9,\n      \"m\": 7,\n      \"gnm\": 8.6,\n      \"hnm\": -0.6,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 8,\n      \"gnm\": -8.7,\n      \"hnm\": 0.8,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 9,\n      \"m\": 9,\n      \"gnm\": -12.9,\n      \"hnm\": 10,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 0,\n      \"gnm\": -1.3,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 1,\n      \"gnm\": -6.4,\n      \"hnm\": 3.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 2,\n      \"gnm\": 0.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 2.4,\n      \"dgnm\": 0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 4,\n      \"gnm\": -1,\n      \"hnm\": 5.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 5,\n      \"gnm\": -0.6,\n      \"hnm\": -9.1,\n      \"dgnm\": -0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 6,\n      \"gnm\": -0.9,\n      \"hnm\": 0.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 7,\n      \"gnm\": 1.5,\n      \"hnm\": -4.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": -3.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 9,\n      \"gnm\": -2.7,\n      \"hnm\": 0.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 10,\n      \"gnm\": -3.9,\n      \"hnm\": -9.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 0,\n      \"gnm\": 2.9,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 1,\n      \"gnm\": -1.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 2,\n      \"gnm\": -2.5,\n      \"hnm\": 2.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 3,\n      \"gnm\": 2.4,\n      \"hnm\": -0.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 4,\n      \"gnm\": -0.6,\n      \"hnm\": 0.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 5,\n      \"gnm\": -0.1,\n      \"hnm\": 0.5,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 6,\n      \"gnm\": -0.6,\n      \"hnm\": -0.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 7,\n      \"gnm\": -0.1,\n      \"hnm\": -1.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 8,\n      \"gnm\": 1.1,\n      \"hnm\": -1.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 9,\n      \"gnm\": -1,\n      \"hnm\": -2.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 11,\n      \"gnm\": 2.6,\n      \"hnm\": -2.3,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 0,\n      \"gnm\": -2,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 1,\n      \"gnm\": -0.2,\n      \"hnm\": -1.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 2,\n      \"gnm\": 0.3,\n      \"hnm\": 0.7,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 3,\n      \"gnm\": 1.2,\n      \"hnm\": 1,\n      \"dgnm\": 0,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 4,\n      \"gnm\": -1.3,\n      \"hnm\": -1.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 5,\n      \"gnm\": 0.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 6,\n      \"gnm\": 0.6,\n      \"hnm\": 0.6,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 7,\n      \"gnm\": 0.5,\n      \"hnm\": -0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 8,\n      \"gnm\": -0.1,\n      \"hnm\": 0.8,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 9,\n      \"gnm\": -0.4,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 11,\n      \"gnm\": -1.3,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 12,\n      \"gnm\": -0.7,\n      \"hnm\": 0.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    }\n  ]\n};","import geomag from './geomag.js';\r\n\r\nconst getLocation = () => {\r\n  const promise = new Promise((resolve, reject) => {\r\n    navigator.geolocation.getCurrentPosition((location, error) => {\r\n      if (!error) {\r\n        const { declination } = geomag(location.coords);\r\n        location.declination = declination;\r\n        resolve(location);\r\n      }\r\n      else {\r\n        reject(error);\r\n      }\r\n    });\r\n  });\r\n\r\n  return promise;\r\n}\r\n\r\nexport default getLocation;","import angle from './angle.js'\r\n\r\nconst cosSin = (a) => {\r\n  const θ = angle.rad(a);\r\n  return {\r\n    cosθ: Math.cos(θ),\r\n    sinθ: Math.sin(θ)\r\n  }\r\n}\r\n\r\nconst identity = () => [\r\n  [1, 0, 0],\r\n  [0, 1, 0],\r\n  [0, 0, 1]\r\n];\r\n\r\nconst xRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [1, 0, 0],\r\n    [0, cosθ, -sinθ],\r\n    [0, sinθ, cosθ]\r\n  ]\r\n};\r\n\r\nconst yRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, 0, sinθ],\r\n    [0, 1, 0],\r\n    [-sinθ, 0, cosθ]\r\n  ]\r\n};\r\n\r\nconst zRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, -sinθ, 0],\r\n    [sinθ, cosθ, 0],\r\n    [0, 0, 1]\r\n  ]\r\n};\r\n\r\nconst multiply = (...matrices) => {\r\n  let a = matrices[0];\r\n  let c;\r\n\r\n  for (let n = 1; n < matrices.length; n++) {\r\n    const b = matrices[n];\r\n    c = [[], [], []];\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      for (let j = 0; j < 3; j++) {\r\n        c[i][j] = a[i][0] * b[0][j] + a[i][1] * b[1][j] + a[i][2] * b[2][j];\r\n      }\r\n    }\r\n\r\n    a = c;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nconst vectorMultiply = (m, v) => {\r\n  const [ x, y, z ] = v;\r\n  const w = [];\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    w[i] = m[i][0] * x + m[i][1] * y + m[i][2] * z;\r\n  }\r\n\r\n  return w;\r\n};\r\n\r\nconst inverse = (m) => {\r\n  const [ a, b, c ] = m[0];\r\n  const [ d, e, f ] = m[1];\r\n  const [ g, h, i ] = m[2];\r\n\r\n  const a1 = e * i - f * h;\r\n  const b1 = -(d * i - f * g);\r\n  const c1 = d * h - e * g;\r\n  const d1 = -(b * i - c * h);\r\n  const e1 = a * i - c * g;\r\n  const f1 = -(a * h - b * g);\r\n  const g1 = b * f - c * e;\r\n  const h1 = -(a * f - c * d);\r\n  const i1 = a * e - b * d;\r\n\r\n  const det = a * a1 + b * b1 + c * c1;\r\n  \r\n  return [\r\n    [a1 / det, d1 / det, g1 / det],\r\n    [b1 / det, e1 / det, h1 / det],\r\n    [c1 / det, f1 / det, i1 / det]\r\n  ];\r\n}\r\n\r\nexport default { identity, xRotation, yRotation, zRotation, multiply, vectorMultiply, inverse };\r\n","import angle from './angle.js'\r\n\r\nconst { rad, deg, rev } = angle;\r\nconst { cos, sin, atan2 } = Math;\r\n\r\nexport const toRectangular = (c) => {\r\n  let [ λ, φ ] = c;\r\n  λ = rad(λ);\r\n  φ = rad(φ);\r\n\r\n  const cosφ = cos(φ);\r\n\r\n  return [\r\n    cos(λ) * cosφ,\r\n    sin(λ) * cosφ,\r\n    sin(φ)\r\n  ];\r\n};\r\n\r\nexport const toPolar = (c) => {\r\n  const [ x, y, z ] = c;\r\n  return [\r\n    rev(deg(atan2(y, x))),\r\n    deg(atan2(z, Math.sqrt(x * x + y * y)))\r\n  ];\r\n};\r\n\r\nexport default { toRectangular, toPolar }\r\n","\r\nconst project = (c) => {\r\n  const [ x, y, z ] = c;\r\n  const factor = 1 - z;\r\n  return [\r\n    x / factor,\r\n    y / factor\r\n  ];\r\n};\r\n\r\nconst unproject = (c) => {\r\n  const [ x, y ] = c;\r\n  const x2y2 = x * x + y * y;\r\n  const factor = x2y2 + 1;\r\n  return [\r\n    2 * x / factor,\r\n    2 * y / factor,\r\n    (x2y2 - 1) / factor\r\n  ];\r\n};\r\n\r\nexport default { project, unproject }\r\n\r\n","import { toRectangular, toPolar } from './coordinate-conversion.js';\r\nimport projection from './stereographic-projection.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\n\r\nconst createTransformer = (ctx, rotationMatrix, scale) => {\r\n  const xOffset = ctx.canvas.clientWidth * 0.5;\r\n  const yOffset = ctx.canvas.clientHeight * 0.5;\r\n  const inverseRotationMatrix = matrix.inverse(rotationMatrix);\r\n\r\n  const rectangularToScreen = (c) => {\r\n    const c1 = matrix.vectorMultiply(rotationMatrix, c);\r\n    const [ x, y ] = projection.project(c1);\r\n    return [\r\n      x * scale + xOffset,\r\n      y * scale + yOffset\r\n    ];\r\n  }\r\n\r\n  const polarToScreen = (c) => rectangularToScreen(toRectangular(c));\r\n  \r\n  const screenToRectangular = (c) => {\r\n    const [ x, y ] = c;\r\n    const c1 = projection.unproject([\r\n      (x - xOffset) / scale,\r\n      (y - yOffset) / scale\r\n    ]);\r\n    return matrix.vectorMultiply(inverseRotationMatrix, c1);\r\n  }\r\n\r\n  const screenToPolar = (c) => toPolar(screenToRectangular(c));\r\n\r\n  return { polarToScreen, rectangularToScreen, screenToRectangular, screenToPolar };\r\n};\r\n\r\nexport default createTransformer;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\n\r\nconst graticule = [];\r\n\r\n// major longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 90) {\r\n  const coordinates = [];\r\n\r\n  for (let lat = -90; lat <= 90; lat++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\n// minor longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 15) {\r\n  if (lon % 90 > 0) {\r\n    const coordinates = [];\r\n\r\n    for (let lat = -75; lat <= 75; lat++) {\r\n      coordinates.push(toRectangular([lon, lat]));\r\n    }\r\n\r\n    graticule.push(coordinates);\r\n  }\r\n}\r\n\r\n// latitudes\r\n\r\nfor (let lat = -75; lat <= 75; lat += 15) {\r\n  const coordinates = [];\r\n\r\n  for (let lon = 0; lon <= 360; lon++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\nconst drawGraticule = (ctx, rotationMatrix, scale) => {\r\n  const { rectangularToScreen } = createTransformer(ctx, rotationMatrix, scale);\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.shadowBlur = 0;\r\n\r\n  graticule.forEach((coordinates) => {\r\n    coordinates = coordinates.map((c) => rectangularToScreen(c))\r\n    \r\n    ctx.beginPath();\r\n    ctx.moveTo(...coordinates[0]);\r\n\r\n    for (let i = 1; i < coordinates.length; i++) {\r\n      ctx.lineTo(...coordinates[i]);\r\n    }\r\n\r\n    ctx.stroke();    \r\n  });\r\n};\r\n\r\nexport default drawGraticule;","\r\nconst drawRotatedText = (ctx, text, coord, rotation) => {\r\n  ctx.save();\r\n  ctx.translate(...coord);\r\n  ctx.rotate(rotation);\r\n  ctx.fillText(text, 0, 0);\r\n  ctx.restore();\r\n}\r\n\r\nexport default drawRotatedText;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\n\r\nconst { atan2 } = Math;\r\n\r\nconst baseHorizon = [];\r\nconst baseN45 = [];\r\nconst baseS45 = [];\r\nconst direction = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];\r\n\r\nfor (let lon = 0; lon < 360; lon++) {\r\n  baseHorizon.push(toRectangular([lon, 0]));\r\n}\r\n\r\nbaseHorizon.push(baseHorizon[0]);\r\n\r\nfor (let lon = 0; lon < 360; lon += 45) {\r\n  baseN45.push(toRectangular([lon, 45.5]));\r\n  baseN45.push(toRectangular([lon, 45]));\r\n  baseS45.push(toRectangular([lon, -44.5]));\r\n  baseS45.push(toRectangular([lon, -45]));\r\n}\r\n\r\nconst drawAzimuth = (ctx, rotationMatrix, scale) => {\r\n  const { rectangularToScreen } = createTransformer(ctx, rotationMatrix, scale);\r\n\r\n  const horizon = baseHorizon.map(rectangularToScreen);\r\n  const n45 = baseN45.map(rectangularToScreen);\r\n  const s45 = baseS45.map(rectangularToScreen);\r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  for (let lon = 0; lon < 360; lon++) {\r\n    let [ x0, y0 ] = horizon[lon];\r\n    let [ x1, y1 ] = horizon[lon + 1];\r\n    let dx = x1 - x0;\r\n    let dy = y1 - y0;\r\n\r\n    const major = lon % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n    \r\n    if (major) {\r\n      ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'top';\r\n\r\n      const offset = 1.5;\r\n      let rotation = atan2(dy, dx);\r\n      let tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${lon}`, tc, rotation);\r\n\r\n      if (lon % 45 === 0) {\r\n        ctx.font = \"bold 24px Arial, Helvetica, sans-serif\";\r\n        ctx.textBaseline = 'bottom';\r\n\r\n        const i = lon / 45;\r\n        const text = `${direction[i]}`;\r\n\r\n        tc = [x0 + dy * offset, y0 - dx * offset];\r\n        drawRotatedText(ctx, text, tc, rotation);\r\n\r\n        [ x0, y0 ] = n45[i * 2];\r\n        [ x1, y1 ] = n45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n\r\n        [ x0, y0 ] = s45[i * 2];\r\n        [ x1, y1 ] = s45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport default drawAzimuth;","import createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\n\r\nconst { atan2, abs } = Math;\r\n\r\nconst drawAltitude = (ctx, rotationMatrix, scale) => {\r\n  const { polarToScreen, screenToPolar } = createTransformer(ctx, rotationMatrix, scale);\r\n\r\n  const [ longitude ] = screenToPolar([ ctx.canvas.width * 0.5, ctx.canvas.height * 0.5 ]);\r\n  const altitude = [];\r\n\r\n  for (let lat = -89; lat <= 89; lat++) {\r\n    altitude.push(polarToScreen([longitude, lat]));\r\n  }\r\n  \r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.beginPath();\r\n  ctx.moveTo(...altitude[0]);\r\n\r\n  for (let i = 1; i < altitude.length; i++) {\r\n    ctx.lineTo(...altitude[i]);\r\n  }\r\n\r\n  ctx.stroke();    \r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n  ctx.textAlign = 'left';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  altitude.unshift(polarToScreen([longitude, -90]));\r\n\r\n  for (let lat = -89, i = 1; lat <= 89; lat++, i++) {\r\n    const [ x0, y0 ] = altitude[i];\r\n    const [ x1, y1 ] = altitude[i - 1];\r\n    const dx = x0 - x1;\r\n    const dy = y0 - y1;\r\n\r\n    const major = lat % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n\r\n    if (major && lat) {\r\n      const offset = 1.5;\r\n      const rotation = atan2(dx, -dy);\r\n      const tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${abs(lat)}`, tc, rotation);\r\n    }\r\n  }\r\n};\r\n\r\nexport default drawAltitude;","import { deg, rev } from './angle.js';\r\nimport getLocation from './get-location.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\nimport drawGraticule from './draw-graticule.js';\r\nimport drawAzimuth from './draw-azimuth.js';\r\nimport drawAltitude from './draw-altitude.js';\r\n\r\n(async () => {\r\n  const $init = document.querySelector('#init');\r\n  $init.style.setProperty('display', 'block');  \r\n\r\n  // initialize the video from the device's front-facing camera\r\n\r\n  $init.innerHTML = 'Starting camera and video...';\r\n\r\n  if (!navigator.mediaDevices) {\r\n    $init.innerHTML = 'No camera available';\r\n    return;\r\n  }\r\n\r\n  let permission = await navigator.permissions.query({ name: 'camera' });\r\n\r\n  if (permission.state === 'denied') {\r\n    $init.innerHTML = 'Permission to use this device\\'s camera was denied';\r\n    return;\r\n  }\r\n\r\n  const videoOptions = {\r\n    video: { \r\n      facingMode: { exact: 'environment' },\r\n      width: { ideal: window.innerHeight },\r\n      height: { ideal: window.innerWidth }\r\n    }\r\n  };\r\n\r\n  let stream;\r\n\r\n  try {\r\n    stream = await navigator.mediaDevices.getUserMedia(videoOptions);\r\n  }\r\n  catch {\r\n    $init.innerHTML = 'No front-facing camera available';\r\n    return;\r\n  }\r\n\r\n  const $video = document.querySelector('video');\r\n\r\n  if ('srcObject' in $video) {\r\n    $video.srcObject = stream;\r\n  } \r\n  else {\r\n    $video.src = URL.createObjectURL(stream);\r\n  }\r\n\r\n  // initialize the user's location including magentic declination\r\n\r\n  permission = await navigator.permissions.query({ name: 'geolocation' });\r\n\r\n  if (permission.state === 'denied') {\r\n    $init.innerHTML = 'Permission to use this device\\'s location was denied';\r\n    return;\r\n  }\r\n\r\n  let location;\r\n  $init.innerHTML = 'Obtaining device location, please wait ...';\r\n\r\n  try {\r\n    location = await getLocation();\r\n  }\r\n  catch (error) {\r\n    if (error.code === 1) {\r\n      $init.innerHTML = 'Permission to use this device\\'s location was denied';\r\n    }\r\n    else {\r\n      $init.innerHTML = 'Could not obtain a location for this device';\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  setInterval(async () => {\r\n    location = await getLocation();\r\n  }, 1000);\r\n\r\n  // initialize the orientation sensor\r\n\r\n  const HALF_PI = Math.PI * 0.5;\r\n\r\n  if (!AbsoluteOrientationSensor)\r\n  {\r\n    $init.innerHTML = 'Orientation sensor is not supported on this device';\r\n    return;\r\n  }\r\n\r\n  let rotationMatrix;\r\n\r\n  const sensor = new AbsoluteOrientationSensor({ frequency: 30 });\r\n  sensor.onreading = () => {\r\n    const [qx, qy, qz, qw] = sensor.quaternion;\r\n\r\n    // https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles\r\n\r\n    const xy = 2 * (qw * qx + qy * qz);\r\n    const xx = 1 - 2 * (qx * qx + qy * qy);\r\n    const xr = deg(Math.atan2(xy, xx));\r\n\r\n    const ysin = 2 * (qw * qy - qz * qx);\r\n    let yr = deg(Math.abs(ysin > 1) ? Math.sign(ysin) * HALF_PI : Math.asin(ysin));\r\n\r\n    const zy = 2 * (qw * qz + qx * qy);\r\n    const zx = 1 - 2 * (qy * qy + qz * qz);\r\n    let zr = deg(Math.atan2(zy, zx));\r\n\r\n    // adjust for viewing\r\n\r\n    yr = 360 - yr;\r\n    zr = rev(zr - 90 - location.declination);\r\n\r\n    rotationMatrix = matrix.multiply(matrix.xRotation(xr), matrix.yRotation(yr), matrix.zRotation(zr));\r\n  };\r\n\r\n  sensor.start();\r\n\r\n  // initialize the canvas\r\n\r\n  $init.style.setProperty('display', 'none');\r\n\r\n  const canvas = document.querySelector('canvas');\r\n  canvas.width = window.innerWidth;\r\n  canvas.height = window.innerHeight;\r\n\r\n  const ctx = canvas.getContext('2d');\r\n  let scale = 1500;\r\n\r\n  const update = () => {\r\n    if (rotationMatrix) {\r\n      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);\r\n      drawGraticule(ctx, rotationMatrix, scale);\r\n      drawAltitude(ctx, rotationMatrix, scale);\r\n      drawAzimuth(ctx, rotationMatrix, scale);\r\n    }\r\n\r\n    requestAnimationFrame(update);\r\n  };\r\n\r\n  update();\r\n\r\n  // initialize wake lock: keep screen active while in use\r\n\r\n  permission = await navigator.permissions.query({ name: 'screen-wake-lock' });\r\n\r\n  if (permission.state !== 'denied') {\r\n    let wakeLock = await navigator.wakeLock.request('screen');\r\n\r\n    document.addEventListener('visibilitychange', async () => {\r\n      if (document.visibilityState === 'visible') {\r\n        if (!wakeLock) {\r\n          wakeLock = await navigator.wakeLock.request('screen');\r\n          wakeLock.addEventListener('release', () => {\r\n            wakeLock = undefined;\r\n          });\r\n        }\r\n      }\r\n      else {\r\n        if (wakeLock) {\r\n          wakeLock.release();\r\n        }\r\n      }\r\n    });\r\n  }\r\n})();\r\n"],"names":["radiansPerDegree","Math","PI","degreesPerRadian","rad","x","deg","rev","angle","array","n","v","a","Array","undefined","isFunction","Function","i","sqrt","sin","cos","atan2","abs","c","cd","tc","dp","snorm","sp","cp","fn","fm","pp","k","p","b","a2","b2","c2","a4","c4","epoch","model","m","gnm","hnm","dgnm","dhnm","forEach","coefficients","j","D2","flnmj","geomag","location","date","latitude","glat","longitude","glon","altitude","alt","year","Date","getUTCFullYear","msInYear","valueOf","UTC","decimalYear","dt","rlat","rlon","srlon","srlat","crlon","crlat","srlat2","crlat2","q","q1","ct","st","r","d","ca","sa","aor","ar","br","bt","bp","bpp","D4","par","temp1","temp2","parp","bx","by","bz","bh","ti","dec","dip","gv","declination","inclination","intensity","gridVariation","getLocation","Promise","resolve","reject","navigator","geolocation","getCurrentPosition","error","coords","cosSin","matrix","matrices","length","y","z","w","e","f","g","h","a1","b1","c1","det","toRectangular","projection","factor","x2y2","createTransformer","ctx","rotationMatrix","scale","xOffset","canvas","clientWidth","yOffset","clientHeight","inverseRotationMatrix","rectangularToScreen","screenToRectangular","polarToScreen","screenToPolar","toPolar","graticule","lon","coordinates","lat","push","drawRotatedText","text","coord","rotation","save","translate","rotate","fillText","restore","baseHorizon","baseN45","baseS45","direction","$init","document","querySelector","style","setProperty","innerHTML","mediaDevices","permission","permissions","query","name","state","videoOptions","video","facingMode","exact","width","ideal","window","innerHeight","height","innerWidth","stream","getUserMedia","$video","srcObject","src","URL","createObjectURL","code","setInterval","async","HALF_PI","AbsoluteOrientationSensor","sensor","frequency","onreading","qx","qy","qz","qw","quaternion","xy","xx","xr","ysin","yr","sign","asin","zy","zx","zr","start","getContext","update","clearRect","lineWidth","strokeStyle","shadowBlur","map","beginPath","moveTo","lineTo","stroke","drawGraticule","shadowColor","fillStyle","font","textAlign","textBaseline","unshift","x0","y0","x1","y1","dx","dy","major","len","offset","drawAltitude","horizon","n45","s45","drawAzimuth","requestAnimationFrame","wakeLock","request","addEventListener","visibilityState","release"],"mappings":"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"}