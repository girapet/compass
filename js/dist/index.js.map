{"version":3,"file":"index.js","sources":["../environment.js","../dom.js","../video.js","../angle.js","../array.js","../geomag.js","../magnetic-model.js","../state.js","../location.js","../3d-rotation-matrix.js","../orientation.js","../coordinate-conversion.js","../stereographic-projection.js","../create-transformer.js","../overlay-graticule.js","../draw-rotated-text.js","../overlay-azimuth.js","../overlay-altitude.js","../landmark-db.js","../landmark-store.js","../distance-azimuth-sphere.js","../overlay-landmarks.js","../overlay.js","../wake-lock.js","../landmark-manager.js","../index.js"],"sourcesContent":["\r\nconst host = new URL(document.location.href).hostname;\r\nconst environment = host === 'localhost' ? 'development' : 'production';\r\n\r\nexport default environment;\r\n ","\r\nconst toArray = (target) => {\r\n  if (target instanceof Array) {\r\n    return target;\r\n  }\r\n  else if (target instanceof HTMLElement || target instanceof HTMLDocument) {\r\n    return [target];\r\n  }\r\n  else if (target instanceof HTMLCollection) {\r\n    return Array.from(target);\r\n  }\r\n};\r\n\r\nexport const add = (target, children) => {\r\n  const elements = toArray(children);\r\n \r\n  if (!elements) {\r\n    throw new Error('invalid child elements');\r\n  }\r\n\r\n  elements.forEach((c) => target.appendChild(c));\r\n};\r\n\r\nexport const each = (target, action) => {\r\n  const elements = toArray(target);\r\n \r\n  if (!elements) {\r\n    throw new Error('invalid target');\r\n  }\r\n\r\n  elements.forEach((e) => action(e));\r\n};\r\n\r\nconst isContent = (x) => x.constructor.name === 'String' || \r\n  x instanceof Array || \r\n  x instanceof HTMLElement || \r\n  x instanceof HTMLCollection;\r\n\r\nexport const create = (tagName, ...args) => {\r\n  const element = document.createElement(tagName);\r\n\r\n  const properties = args.find((a) => !isContent(a));\r\n\r\n  if (properties) {\r\n    Object.assign(element, properties);\r\n  }\r\n\r\n  const content = args.find(isContent);\r\n\r\n  if (content) {\r\n    if (content.constructor.name === 'String') {\r\n      element.innerHTML = content;\r\n    }\r\n    else {\r\n      add(element, content);\r\n    }\r\n  }\r\n\r\n  return element;\r\n};\r\n\r\nexport const find = (...args) => {\r\n  const selector = args.pop();\r\n  const target = args.length ? args[0] : document;\r\n  return Array.from(target.querySelectorAll(selector));\r\n}\r\n\r\nexport const get = (id) => document.getElementById(id);\r\n\r\nexport const on = (target, type, handler) => each(target, (e) => e.addEventListener(type, handler));\r\n\r\nexport const style = (target, styles) => each(target, (e) => {\r\n  Object.entries(styles).forEach((s) => {\r\n    const [ name, value ] = s;\r\n    e.style[name] = value;\r\n  });\r\n});\r\n\r\nexport default { add, create, each, find, get, on, style };","import dom from './dom.js';\r\n\r\nconst videoOptions = {\r\n  video: { \r\n    facingMode: { exact: 'environment' },\r\n    width: { ideal: window.innerHeight },\r\n    height: { ideal: window.innerWidth }\r\n  }\r\n};\r\n\r\nconst getVideoStream = async () => {\r\n  let stream;\r\n\r\n  try {\r\n    stream = await navigator.mediaDevices.getUserMedia(videoOptions);\r\n  }\r\n  catch {}\r\n\r\n  return stream;\r\n};\r\n\r\nconst initialize = async () => {\r\n  if (!navigator.mediaDevices) {\r\n    return 'No camera available';\r\n  }\r\n\r\n  const permission = await navigator.permissions.query({ name: 'camera' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return 'Permission to use this device\\'s camera was denied';\r\n  }\r\n\r\n  let stream = await getVideoStream();\r\n\r\n  if (!stream) {\r\n    return 'No front-facing camera available';\r\n  }\r\n\r\n  const $videoContainer = dom.get('video-container');\r\n  let $video;\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!$video) {\r\n        if (!stream) {\r\n          stream = await getVideoStream();\r\n        }\r\n\r\n        $video = dom.create('video', { \r\n          autoplay: true,\r\n          mute: true\r\n        });\r\n        dom.add($videoContainer, $video);\r\n        $video.srcObject = stream;\r\n      }\r\n    }\r\n    else {\r\n      if ($video) {\r\n        $video.srcObject.getTracks().forEach((t) => t.stop());\r\n        $video.remove();\r\n        $video = undefined;\r\n        stream = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  await visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","\r\nconst radiansPerDegree = Math.PI / 180;\r\nconst degreesPerRadian = 1 / radiansPerDegree;\r\n\r\nexport const rad = (x) => x * radiansPerDegree;\r\nexport const deg = (x) => x * degreesPerRadian;\r\n\r\nexport const rev = (x) => {\r\n  x = x % 360;\r\n  return x >= 0 ? x : x + 360;\r\n};\r\n\r\nexport default { rad, deg, rev }\r\n\r\n","\r\n// creates a new array of size n filled with value v; the value can also be a function \r\n// that returns a value\r\n\r\nconst array = (n, v) => {\r\n  const a = new Array(n);\r\n\r\n  if (v !== undefined) {\r\n    const isFunction = v instanceof Function;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      a[i] = isFunction ? v() : v;\r\n    }\r\n  }\r\n\r\n  return a;\r\n};\r\n\r\nexport default array;","// adapted from https://github.com/cmweiss/geomagJS/blob/master/geomag.js\r\n// World Magnetic Model: https://www.ncei.noaa.gov/products/world-magnetic-model\r\n\r\nimport magneticModel from './magnetic-model.js';\r\nimport { rad, deg } from './angle.js';\r\nimport array from './array.js';\r\n\r\nconst { sqrt, sin, cos, atan2, abs } = Math;\r\n\r\nconst c = array(13, () => array(13));\r\nconst cd = array(13, () => array(13));\r\nconst tc = array(13, () => array(13));\r\nconst dp = array(13, () => array(13));\r\nconst snorm = array(13, () => array(13));\r\nconst sp = array(13);\r\nconst cp = array(13);\r\nconst fn = array(13);\r\nconst fm = array(13);\r\nconst pp = array(13);\r\nconst k = array(13, () => array(13));\r\nconst p = array(13, () => array(13));\r\n\r\nconst maxord = 12;\r\n\r\nsp[0] = 0;\r\ncp[0] = 1;\r\np[0][0] = 1;\r\npp[0] = 1;\r\ndp[0][0] = 0;\r\n\r\nconst a = 6378.137;\r\nconst b = 6356.7523142;\r\nconst re = 6371.2;\r\nconst a2 = a * a;\r\nconst b2 = b * b;\r\nconst c2 = a2 - b2;\r\nconst a4 = a2 * a2;\r\nconst b4 = b2 * b2;\r\nconst c4 = a4 - b4;\r\n\r\n// read World Magnetic Model spherical harmonic coefficients\r\n\r\nc[0][0] = 0;\r\ncd[0][0] = 0;\r\n\r\nconst { epoch, model } = magneticModel;\r\n\r\nmodel.forEach((coefficients) => {\r\n  const { n, m, gnm, hnm, dgnm , dhnm } = coefficients;\r\n\r\n  if (m <= n) {\r\n    c[m][n] = gnm;\r\n    cd[m][n] = dgnm;\r\n    \r\n    if (m !== 0) {\r\n      c[n][m - 1] = hnm;\r\n      cd[n][m - 1] = dhnm;\r\n    }\r\n  }\r\n});\r\n\r\n// convert Schmidt normalized Gauss coefficients to unnormalized\r\n\r\nsnorm[0][0] = 1;\r\nfm[0] = 0;\r\n\r\nfor (let n = 1; n <= maxord; n++) {\r\n  snorm[0][n] = snorm[0][n - 1] * (2 * n - 1) / n;\r\n  let j = 2;\r\n\r\n  for (let m = 0, D2 = n - m + 1; D2 > 0; D2--, m++) {\r\n    k[m][n] = (((n - 1) * (n - 1)) - (m * m)) / ((2 * n - 1) * (2 * n - 3));\r\n\r\n    if (m > 0) {\r\n      const flnmj = ((n - m + 1) * j) / (n + m);\r\n      snorm[m][n] = snorm[m - 1][n] * sqrt(flnmj);\r\n      j = 1;\r\n      c[n][m - 1] = snorm[m][n] * c[n][m - 1];\r\n      cd[n][m - 1] = snorm[m][n] * cd[n][m - 1];\r\n    }\r\n\r\n    c[m][n] = snorm[m][n] * c[m][n];\r\n    cd[m][n] = snorm[m][n] * cd[m][n];\r\n  }\r\n\r\n  fn[n] = n + 1;\r\n  fm[n] = n;\r\n}\r\n\r\nk[1][1] = 0.0;\r\n\r\nconst decimalYear = (date) => {\r\n  date = date || new Date();\r\n  const year = date.getUTCFullYear();\r\n  const daysInYear = 365 + (((year % 400 === 0) || (year % 4 === 0 && (year % 100 > 0))) ? 1 : 0);\r\n  const msInYear = daysInYear * 24 * 60 * 60 * 1000;\r\n  return year + (date.valueOf() - Date.UTC(year, 0)) / msInYear;\r\n};\r\n\r\nconst geomag = (location, date) => {\r\n  const { latitude: glat, longitude: glon, altitude: alt } = location;\r\n  const year = decimalYear(date);\r\n  \r\n  const dt = year - epoch;\r\n  const rlat = rad(glat);\r\n  const rlon = rad(glon);\r\n  const srlon = sin(rlon);\r\n  const srlat = sin(rlat);\r\n  const crlon = cos(rlon);\r\n  const crlat = cos(rlat);\r\n  const srlat2 = srlat * srlat;\r\n  const crlat2 = crlat * crlat;\r\n\r\n  sp[1] = srlon;\r\n  cp[1] = crlon;\r\n\r\n  // convert from geodetic to spherical coordinates\r\n\r\n  const q = sqrt(a2 - c2 * srlat2);\r\n  const q1 = alt * q;\r\n  const q2 = ((q1 + a2) / (q1 + b2)) * ((q1 + a2) / (q1 + b2));\r\n  const ct = srlat / sqrt(q2 * crlat2 + srlat2);\r\n  const st = sqrt(1 - (ct * ct));\r\n  const r2 = (alt * alt) + 2 * q1 + (a4 - c4 * srlat2) / (q * q);\r\n  const r = sqrt(r2);\r\n  const d = sqrt(a2 * crlat2 + b2 * srlat2);\r\n  const ca = (alt + d) / r;\r\n  const sa = c2 * crlat * srlat / (r * d);\r\n\r\n  for (let m = 2; m <= maxord; m++) {\r\n    sp[m] = sp[1] * cp[m - 1] + cp[1] * sp[m - 1];\r\n    cp[m] = cp[1] * cp[m - 1] - sp[1] * sp[m - 1];\r\n  }\r\n\r\n  const aor = re / r;\r\n  let ar = aor * aor;\r\n  let br = 0;\r\n  let bt = 0;\r\n  let bp = 0;\r\n  let bpp = 0;\r\n\r\n  for (let n = 1; n <= maxord; n++) {\r\n    ar = ar * aor;\r\n    \r\n    for (let m = 0, D4 = n + m + 1; D4 > 0; D4--, m++) {\r\n\r\n      // compute unnormalized associated Legendre polynomials and derivatives via recursion relations\r\n\r\n      if (n === m) {\r\n        p[m][n] = st * p[m - 1][n - 1];\r\n        dp[m][n] = st * dp[m - 1][n - 1] + ct * p[m - 1][n - 1];\r\n      } \r\n      else if (n === 1 && m === 0) {\r\n        p[m][n] = ct * p[m][n - 1];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1];\r\n      } \r\n      else if (n > 1 && n !== m) {\r\n        if (m > n - 2) { \r\n          p[m][n - 2] = 0; \r\n        }\r\n        \r\n        if (m > n - 2) { \r\n          dp[m][n - 2] = 0; \r\n        }\r\n        \r\n        p[m][n] = ct * p[m][n - 1] - k[m][n] * p[m][n - 2];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1] - k[m][n] * dp[m][n - 2];\r\n      }\r\n\r\n      // time adjust the Gauss coefficients\r\n\r\n      tc[m][n] = c[m][n] + dt * cd[m][n];\r\n\r\n      if (m !== 0) {\r\n        tc[n][m - 1] = c[n][m - 1] + dt * cd[n][m - 1];\r\n      }\r\n\r\n      // accumulate terms of the spherical harmonic expansions\r\n\r\n      const par = ar * p[m][n];\r\n      let temp1, temp2;\r\n\r\n      if (m === 0) {\r\n        temp1 = tc[m][n] * cp[m];\r\n        temp2 = tc[m][n] * sp[m];\r\n      } \r\n      else {\r\n        temp1 = tc[m][n] * cp[m] + tc[n][m - 1] * sp[m];\r\n        temp2 = tc[m][n] * sp[m] - tc[n][m - 1] * cp[m];\r\n      }\r\n\r\n      bt = bt - ar * temp1 * dp[m][n];\r\n      bp += fm[m] * temp2 * par;\r\n      br += fn[n] * temp1 * par;\r\n\r\n      // special case: north/south geographic poles\r\n\r\n      if (st === 0 && m === 1) {\r\n        if (n === 1) {\r\n          pp[n] = pp[n - 1];\r\n        } \r\n        else {\r\n          pp[n] = ct * pp[n - 1] - k[m][n] * pp[n - 2];\r\n        }\r\n\r\n        const parp = ar * pp[n];\r\n        bpp += (fm[m] * temp2 * parp);\r\n      }\r\n    }\r\n  }\r\n\r\n  bp = st === 0 ? bpp : bp / st;\r\n\r\n  // rotate magnetic vector components from spherical to geodetic coordinates\r\n\r\n  const bx = -bt * ca - br * sa;\r\n  const by = bp;\r\n  const bz = bt * sa - br * ca;\r\n\r\n  // compute declination (dec), inclination (dip) and total intensity (ti)\r\n\r\n  const bh = sqrt((bx * bx) + (by * by));\r\n  const ti = sqrt((bh * bh) + (bz * bz));\r\n  const dec = deg(atan2(by, bx));\r\n  const dip = deg(atan2(bz, bh));\r\n\r\n  // compute magnetic grid variation if the current geodetic position is in the arctic or antarctic\r\n  // (i.e. glat > +55 degrees or glat < -55 degrees) otherwise, set magnetic grid variation to -999.0\r\n\r\n  let gv = -999;\r\n\r\n  if (abs(glat) >= 55) {\r\n    if (glat > 0 && glon >= 0) {\r\n       gv = dec - glon;\r\n    }\r\n\r\n    if (glat > 0 && glon < 0) {\r\n      gv =  dec + abs(glon);\r\n    }\r\n\r\n    if (glat < 0 && glon >= 0) {\r\n      gv = dec + glon;\r\n    }\r\n\r\n    if (glat < 0 && glon < 0) {\r\n      gv = dec - abs(glon);\r\n    }\r\n\r\n    if (gv > 180) {\r\n      gv -= 360;\r\n    }\r\n\r\n    if (gv < -180) {\r\n      gv += 360;\r\n    }\r\n  }\r\n\r\n  return { declination: dec, inclination: dip, intensity: ti, gridVariation: gv };\r\n  // return { declination: dec, inclination: dip, intensity: ti, gridVariation: gv, bx, by, bz, bh };\r\n};\r\n\r\nexport default geomag;","// generated by processing/convert-magnetic-model.js, do not edit\n\nexport default {\n  \"epoch\": 2025,\n  \"modelName\": \"WMM-2025\",\n  \"modelDate\": \"11/13/2024\",\n  \"model\": [\n    {\n      \"n\": 1,\n      \"m\": 0,\n      \"gnm\": -29351.8,\n      \"hnm\": 0,\n      \"dgnm\": 12,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 1,\n      \"m\": 1,\n      \"gnm\": -1410.8,\n      \"hnm\": 4545.4,\n      \"dgnm\": 9.7,\n      \"dhnm\": -21.5\n    },\n    {\n      \"n\": 2,\n      \"m\": 0,\n      \"gnm\": -2556.6,\n      \"hnm\": 0,\n      \"dgnm\": -11.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 2,\n      \"m\": 1,\n      \"gnm\": 2951.1,\n      \"hnm\": -3133.6,\n      \"dgnm\": -5.2,\n      \"dhnm\": -27.7\n    },\n    {\n      \"n\": 2,\n      \"m\": 2,\n      \"gnm\": 1649.3,\n      \"hnm\": -815.1,\n      \"dgnm\": -8,\n      \"dhnm\": -12.1\n    },\n    {\n      \"n\": 3,\n      \"m\": 0,\n      \"gnm\": 1361,\n      \"hnm\": 0,\n      \"dgnm\": -1.3,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 3,\n      \"m\": 1,\n      \"gnm\": -2404.1,\n      \"hnm\": -56.6,\n      \"dgnm\": -4.2,\n      \"dhnm\": 4\n    },\n    {\n      \"n\": 3,\n      \"m\": 2,\n      \"gnm\": 1243.8,\n      \"hnm\": 237.5,\n      \"dgnm\": 0.4,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 3,\n      \"m\": 3,\n      \"gnm\": 453.6,\n      \"hnm\": -549.5,\n      \"dgnm\": -15.6,\n      \"dhnm\": -4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 0,\n      \"gnm\": 895,\n      \"hnm\": 0,\n      \"dgnm\": -1.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 4,\n      \"m\": 1,\n      \"gnm\": 799.5,\n      \"hnm\": 278.6,\n      \"dgnm\": -2.4,\n      \"dhnm\": -1.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 2,\n      \"gnm\": 55.7,\n      \"hnm\": -133.9,\n      \"dgnm\": -6,\n      \"dhnm\": 4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 3,\n      \"gnm\": -281.1,\n      \"hnm\": 212,\n      \"dgnm\": 5.6,\n      \"dhnm\": 1.6\n    },\n    {\n      \"n\": 4,\n      \"m\": 4,\n      \"gnm\": 12.1,\n      \"hnm\": -375.6,\n      \"dgnm\": -7,\n      \"dhnm\": -4.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 0,\n      \"gnm\": -233.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 5,\n      \"m\": 1,\n      \"gnm\": 368.9,\n      \"hnm\": 45.4,\n      \"dgnm\": 1.4,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 5,\n      \"m\": 2,\n      \"gnm\": 187.2,\n      \"hnm\": 220.2,\n      \"dgnm\": 0,\n      \"dhnm\": 2.2\n    },\n    {\n      \"n\": 5,\n      \"m\": 3,\n      \"gnm\": -138.7,\n      \"hnm\": -122.9,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 4,\n      \"gnm\": -142,\n      \"hnm\": 43,\n      \"dgnm\": 2.2,\n      \"dhnm\": 1.7\n    },\n    {\n      \"n\": 5,\n      \"m\": 5,\n      \"gnm\": 20.9,\n      \"hnm\": 106.1,\n      \"dgnm\": 0.9,\n      \"dhnm\": 1.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 0,\n      \"gnm\": 64.4,\n      \"hnm\": 0,\n      \"dgnm\": -0.2,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 6,\n      \"m\": 1,\n      \"gnm\": 63.8,\n      \"hnm\": -18.4,\n      \"dgnm\": -0.4,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 6,\n      \"m\": 2,\n      \"gnm\": 76.9,\n      \"hnm\": 16.8,\n      \"dgnm\": 0.9,\n      \"dhnm\": -1.6\n    },\n    {\n      \"n\": 6,\n      \"m\": 3,\n      \"gnm\": -115.7,\n      \"hnm\": 48.8,\n      \"dgnm\": 1.2,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 6,\n      \"m\": 4,\n      \"gnm\": -40.9,\n      \"hnm\": -59.8,\n      \"dgnm\": -0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 5,\n      \"gnm\": 14.9,\n      \"hnm\": 10.9,\n      \"dgnm\": 0.3,\n      \"dhnm\": 0.7\n    },\n    {\n      \"n\": 6,\n      \"m\": 6,\n      \"gnm\": -60.7,\n      \"hnm\": 72.7,\n      \"dgnm\": 0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 7,\n      \"m\": 0,\n      \"gnm\": 79.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 1,\n      \"gnm\": -77,\n      \"hnm\": -48.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 2,\n      \"gnm\": -8.8,\n      \"hnm\": -14.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 7,\n      \"m\": 3,\n      \"gnm\": 59.3,\n      \"hnm\": -1,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.8\n    },\n    {\n      \"n\": 7,\n      \"m\": 4,\n      \"gnm\": 15.8,\n      \"hnm\": 23.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 5,\n      \"gnm\": 2.5,\n      \"hnm\": -7.4,\n      \"dgnm\": -0.8,\n      \"dhnm\": -1\n    },\n    {\n      \"n\": 7,\n      \"m\": 6,\n      \"gnm\": -11.1,\n      \"hnm\": -25.1,\n      \"dgnm\": -0.8,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 7,\n      \"gnm\": 14.2,\n      \"hnm\": -2.3,\n      \"dgnm\": 0.8,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 0,\n      \"gnm\": 23.2,\n      \"hnm\": 0,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 8,\n      \"m\": 1,\n      \"gnm\": 10.8,\n      \"hnm\": 7.1,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 2,\n      \"gnm\": -17.5,\n      \"hnm\": -12.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 11.4,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 4,\n      \"gnm\": -21.7,\n      \"hnm\": -9.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 5,\n      \"gnm\": 16.9,\n      \"hnm\": 12.7,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 6,\n      \"gnm\": 15,\n      \"hnm\": 0.7,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.6\n    },\n    {\n      \"n\": 8,\n      \"m\": 7,\n      \"gnm\": -16.8,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 8,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": 3.9,\n      \"dgnm\": 0.2,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 0,\n      \"gnm\": 4.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 9,\n      \"m\": 1,\n      \"gnm\": 7.8,\n      \"hnm\": -24.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 2,\n      \"gnm\": 3,\n      \"hnm\": 12.2,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 3,\n      \"gnm\": -0.2,\n      \"hnm\": 8.3,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 4,\n      \"gnm\": -2.5,\n      \"hnm\": -3.3,\n      \"dgnm\": -0.3,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 5,\n      \"gnm\": -13.1,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 6,\n      \"gnm\": 2.4,\n      \"hnm\": 7.2,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 9,\n      \"m\": 7,\n      \"gnm\": 8.6,\n      \"hnm\": -0.6,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 8,\n      \"gnm\": -8.7,\n      \"hnm\": 0.8,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 9,\n      \"m\": 9,\n      \"gnm\": -12.9,\n      \"hnm\": 10,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 0,\n      \"gnm\": -1.3,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 1,\n      \"gnm\": -6.4,\n      \"hnm\": 3.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 2,\n      \"gnm\": 0.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 2.4,\n      \"dgnm\": 0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 4,\n      \"gnm\": -1,\n      \"hnm\": 5.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 5,\n      \"gnm\": -0.6,\n      \"hnm\": -9.1,\n      \"dgnm\": -0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 6,\n      \"gnm\": -0.9,\n      \"hnm\": 0.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 7,\n      \"gnm\": 1.5,\n      \"hnm\": -4.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": -3.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 9,\n      \"gnm\": -2.7,\n      \"hnm\": 0.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 10,\n      \"gnm\": -3.9,\n      \"hnm\": -9.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 0,\n      \"gnm\": 2.9,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 1,\n      \"gnm\": -1.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 2,\n      \"gnm\": -2.5,\n      \"hnm\": 2.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 3,\n      \"gnm\": 2.4,\n      \"hnm\": -0.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 4,\n      \"gnm\": -0.6,\n      \"hnm\": 0.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 5,\n      \"gnm\": -0.1,\n      \"hnm\": 0.5,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 6,\n      \"gnm\": -0.6,\n      \"hnm\": -0.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 7,\n      \"gnm\": -0.1,\n      \"hnm\": -1.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 8,\n      \"gnm\": 1.1,\n      \"hnm\": -1.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 9,\n      \"gnm\": -1,\n      \"hnm\": -2.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 11,\n      \"gnm\": 2.6,\n      \"hnm\": -2.3,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 0,\n      \"gnm\": -2,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 1,\n      \"gnm\": -0.2,\n      \"hnm\": -1.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 2,\n      \"gnm\": 0.3,\n      \"hnm\": 0.7,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 3,\n      \"gnm\": 1.2,\n      \"hnm\": 1,\n      \"dgnm\": 0,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 4,\n      \"gnm\": -1.3,\n      \"hnm\": -1.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 5,\n      \"gnm\": 0.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 6,\n      \"gnm\": 0.6,\n      \"hnm\": 0.6,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 7,\n      \"gnm\": 0.5,\n      \"hnm\": -0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 8,\n      \"gnm\": -0.1,\n      \"hnm\": 0.8,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 9,\n      \"gnm\": -0.4,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 11,\n      \"gnm\": -1.3,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 12,\n      \"gnm\": -0.7,\n      \"hnm\": 0.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    }\n  ]\n};","\r\n// state shared between modules\r\n\r\nconst state = {\r\n  units: 'US/Imperial',       // US/Imperial (feet, miles) or International (meters, kilometers)\r\n  scale: 1500,                // stereographic projection scale, calibrates graticule to video\r\n  location: undefined,        // from GeoLocation API\r\n  rotationMatrix: undefined,  // 3x3 rotation matrix to handle device orientation\r\n  canvasContext: undefined    // CanvasRenderingContext2D\r\n};\r\n\r\nexport default state;","import dom from './dom.js';\r\nimport geomag from './geomag.js';\r\nimport state from './state.js';\r\n\r\nconst getLocation = () => {\r\n  const promise = new Promise((resolve, reject) => {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      const { declination } = geomag(location.coords);\r\n      location.declination = declination;\r\n      resolve(location);\r\n    },\r\n    () => resolve());\r\n  });\r\n\r\n  return promise;\r\n}\r\n\r\nconst initialize = async () => {\r\n  const permission = await navigator.permissions.query({ name: 'geolocation' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return 'Permission to use this device\\'s location was denied';\r\n  }\r\n\r\n  let location = await getLocation();\r\n\r\n  if (!location) {\r\n    return 'Could not get a location for this device';\r\n  }\r\n\r\n  state.location = location;\r\n  let intervalHandle;\r\n\r\n  const visibilityChangeHandler = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!intervalHandle) {\r\n        intervalHandle = setInterval(async () => {\r\n          location = await getLocation();\r\n\r\n          if (location) {\r\n            state.location = location;\r\n          }\r\n        }, 1000);\r\n      }\r\n    }\r\n    else {\r\n      if (intervalHandle) {\r\n        clearInterval(intervalHandle);\r\n        intervalHandle = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n}\r\n\r\nexport default { initialize };","import angle from './angle.js'\r\n\r\nconst cosSin = (a) => {\r\n  const θ = angle.rad(a);\r\n  return {\r\n    cosθ: Math.cos(θ),\r\n    sinθ: Math.sin(θ)\r\n  }\r\n}\r\n\r\nexport const identity = () => [\r\n  [1, 0, 0],\r\n  [0, 1, 0],\r\n  [0, 0, 1]\r\n];\r\n\r\nexport const xRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [1, 0, 0],\r\n    [0, cosθ, -sinθ],\r\n    [0, sinθ, cosθ]\r\n  ]\r\n};\r\n\r\nexport const yRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, 0, sinθ],\r\n    [0, 1, 0],\r\n    [-sinθ, 0, cosθ]\r\n  ]\r\n};\r\n\r\nexport const zRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, -sinθ, 0],\r\n    [sinθ, cosθ, 0],\r\n    [0, 0, 1]\r\n  ]\r\n};\r\n\r\nexport const multiply = (...matrices) => {\r\n  let a = matrices[0];\r\n  let c;\r\n\r\n  for (let n = 1; n < matrices.length; n++) {\r\n    const b = matrices[n];\r\n    c = [[], [], []];\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      for (let j = 0; j < 3; j++) {\r\n        c[i][j] = a[i][0] * b[0][j] + a[i][1] * b[1][j] + a[i][2] * b[2][j];\r\n      }\r\n    }\r\n\r\n    a = c;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport const vectorMultiply = (m, v) => {\r\n  const [ x, y, z ] = v;\r\n  const w = [];\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    w[i] = m[i][0] * x + m[i][1] * y + m[i][2] * z;\r\n  }\r\n\r\n  return w;\r\n};\r\n\r\nexport const inverse = (m) => {\r\n  const [ a, b, c ] = m[0];\r\n  const [ d, e, f ] = m[1];\r\n  const [ g, h, i ] = m[2];\r\n\r\n  const a1 = e * i - f * h;\r\n  const b1 = -(d * i - f * g);\r\n  const c1 = d * h - e * g;\r\n  const d1 = -(b * i - c * h);\r\n  const e1 = a * i - c * g;\r\n  const f1 = -(a * h - b * g);\r\n  const g1 = b * f - c * e;\r\n  const h1 = -(a * f - c * d);\r\n  const i1 = a * e - b * d;\r\n\r\n  const det = a * a1 + b * b1 + c * c1;\r\n  \r\n  return [\r\n    [a1 / det, d1 / det, g1 / det],\r\n    [b1 / det, e1 / det, h1 / det],\r\n    [c1 / det, f1 / det, i1 / det]\r\n  ];\r\n}\r\n\r\nexport default { identity, xRotation, yRotation, zRotation, multiply, vectorMultiply, inverse };\r\n","import { deg, rev } from './angle.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\nimport dom from './dom.js';\r\nimport state from './state.js';\r\n\r\nconst { atan2, abs, sign, asin } = Math;\r\nconst HALF_PI = Math.PI * 0.5;\r\n\r\nconst initialize = () => {\r\n  if (!AbsoluteOrientationSensor) {\r\n    return 'Orientation sensor is not supported on this device';\r\n  }\r\n\r\n  const sensor = new AbsoluteOrientationSensor({ frequency: 30 });\r\n  sensor.onreading = () => {\r\n    if (!state.location) {\r\n      return;\r\n    }\r\n\r\n    const [qx, qy, qz, qw] = sensor.quaternion;\r\n\r\n    // https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles\r\n\r\n    const xy = 2 * (qw * qx + qy * qz);\r\n    const xx = 1 - 2 * (qx * qx + qy * qy);\r\n    const xr = deg(atan2(xy, xx));\r\n\r\n    const ysin = 2 * (qw * qy - qz * qx);\r\n    let yr = deg(abs(ysin > 1) ? sign(ysin) * HALF_PI : asin(ysin));\r\n\r\n    const zy = 2 * (qw * qz + qx * qy);\r\n    const zx = 1 - 2 * (qy * qy + qz * qz);\r\n    let zr = deg(atan2(zy, zx));\r\n\r\n    // adjust for viewing\r\n\r\n    yr = 360 - yr;\r\n    zr = rev(zr - 90 - state.location.declination);\r\n\r\n    state.rotationMatrix = matrix.multiply(matrix.xRotation(xr), matrix.yRotation(yr), matrix.zRotation(zr));\r\n  };\r\n\r\n  sensor.start();\r\n\r\n  const visibilityChangeHandler = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      sensor.start();\r\n    }\r\n    else {\r\n      sensor.stop();\r\n    }\r\n  };\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","import angle from './angle.js'\r\n\r\nconst { rad, deg, rev } = angle;\r\nconst { cos, sin, atan2 } = Math;\r\n\r\nexport const toRectangular = (c) => {\r\n  let [ λ, φ ] = c;\r\n  λ = rad(λ);\r\n  φ = rad(φ);\r\n\r\n  const cosφ = cos(φ);\r\n\r\n  return [\r\n    cos(λ) * cosφ,\r\n    sin(λ) * cosφ,\r\n    sin(φ)\r\n  ];\r\n};\r\n\r\nexport const toPolar = (c) => {\r\n  const [ x, y, z ] = c;\r\n  return [\r\n    rev(deg(atan2(y, x))),\r\n    deg(atan2(z, Math.sqrt(x * x + y * y)))\r\n  ];\r\n};\r\n\r\nexport default { toRectangular, toPolar }\r\n","\r\nconst project = (c) => {\r\n  const [ x, y, z ] = c;\r\n  const factor = 1 - z;\r\n  return [\r\n    x / factor,\r\n    y / factor\r\n  ];\r\n};\r\n\r\nconst unproject = (c) => {\r\n  const [ x, y ] = c;\r\n  const x2y2 = x * x + y * y;\r\n  const factor = x2y2 + 1;\r\n  return [\r\n    2 * x / factor,\r\n    2 * y / factor,\r\n    (x2y2 - 1) / factor\r\n  ];\r\n};\r\n\r\nexport default { project, unproject }\r\n\r\n","import { toRectangular, toPolar } from './coordinate-conversion.js';\r\nimport projection from './stereographic-projection.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\nimport state from './state.js';\r\n\r\nconst createTransformer = () => {\r\n  const { scale, rotationMatrix, canvasContext: ctx } = state;\r\n\r\n  const xOffset = ctx.canvas.clientWidth * 0.5;\r\n  const yOffset = ctx.canvas.clientHeight * 0.5;\r\n  const inverseRotationMatrix = matrix.inverse(rotationMatrix);\r\n\r\n  const rectangularToScreen = (c) => {\r\n    const c1 = matrix.vectorMultiply(rotationMatrix, c);\r\n    const [ x, y ] = projection.project(c1);\r\n    return [\r\n      x * scale + xOffset,\r\n      y * scale + yOffset\r\n    ];\r\n  }\r\n\r\n  const polarToScreen = (c) => rectangularToScreen(toRectangular(c));\r\n  \r\n  const screenToRectangular = (c) => {\r\n    const [ x, y ] = c;\r\n    const c1 = projection.unproject([\r\n      (x - xOffset) / scale,\r\n      (y - yOffset) / scale\r\n    ]);\r\n    return matrix.vectorMultiply(inverseRotationMatrix, c1);\r\n  }\r\n\r\n  const screenToPolar = (c) => toPolar(screenToRectangular(c));\r\n\r\n  return { polarToScreen, rectangularToScreen, screenToRectangular, screenToPolar };\r\n};\r\n\r\nexport default createTransformer;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\nimport state from './state.js';\r\n\r\nconst graticule = [];\r\n\r\n// major longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 90) {\r\n  const coordinates = [];\r\n\r\n  for (let lat = -90; lat <= 90; lat++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\n// minor longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 15) {\r\n  if (lon % 90 > 0) {\r\n    const coordinates = [];\r\n\r\n    for (let lat = -75; lat <= 75; lat++) {\r\n      coordinates.push(toRectangular([lon, lat]));\r\n    }\r\n\r\n    graticule.push(coordinates);\r\n  }\r\n}\r\n\r\n// latitudes\r\n\r\nfor (let lat = -75; lat <= 75; lat += 15) {\r\n  const coordinates = [];\r\n\r\n  for (let lon = 0; lon <= 360; lon++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\nconst overlayGraticule = () => {\r\n  const { canvasContext: ctx } = state;\r\n  const { rectangularToScreen } = createTransformer();\r\n\r\n  ctx.save();\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.shadowBlur = 0;\r\n\r\n  graticule.forEach((coordinates) => {\r\n    coordinates = coordinates.map((c) => rectangularToScreen(c))\r\n    \r\n    ctx.beginPath();\r\n    ctx.moveTo(...coordinates[0]);\r\n\r\n    for (let i = 1; i < coordinates.length; i++) {\r\n      ctx.lineTo(...coordinates[i]);\r\n    }\r\n\r\n    ctx.stroke();    \r\n  });\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayGraticule;","\r\nconst drawRotatedText = (ctx, text, origin, rotation, offset = [0, 0]) => {\r\n  ctx.save();\r\n  ctx.translate(...origin);\r\n  ctx.rotate(rotation);\r\n  ctx.fillText(text, ...offset);\r\n  ctx.restore();\r\n}\r\n\r\nexport default drawRotatedText;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\nimport state from './state.js';\r\n\r\nconst { atan2 } = Math;\r\n\r\nconst baseHorizon = [];\r\nconst baseN45 = [];\r\nconst baseS45 = [];\r\nconst direction = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];\r\n\r\nfor (let lon = 0; lon < 360; lon++) {\r\n  baseHorizon.push(toRectangular([lon, 0]));\r\n}\r\n\r\nbaseHorizon.push(baseHorizon[0]);\r\n\r\nfor (let lon = 0; lon < 360; lon += 45) {\r\n  baseN45.push(toRectangular([lon, 45.5]));\r\n  baseN45.push(toRectangular([lon, 45]));\r\n  baseS45.push(toRectangular([lon, -44.5]));\r\n  baseS45.push(toRectangular([lon, -45]));\r\n}\r\n\r\nconst overlayAzimuth = () => {\r\n  const { canvasContext: ctx } = state;\r\n  const { rectangularToScreen } = createTransformer();\r\n\r\n  const horizon = baseHorizon.map(rectangularToScreen);\r\n  const n45 = baseN45.map(rectangularToScreen);\r\n  const s45 = baseS45.map(rectangularToScreen);\r\n\r\n  ctx.save();\r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  for (let lon = 0; lon < 360; lon++) {\r\n    let [ x0, y0 ] = horizon[lon];\r\n    let [ x1, y1 ] = horizon[lon + 1];\r\n    let dx = x1 - x0;\r\n    let dy = y1 - y0;\r\n\r\n    const major = lon % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n    \r\n    if (major) {\r\n      ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'top';\r\n\r\n      const offset = 1.5;\r\n      let rotation = atan2(dy, dx);\r\n      let tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${lon}`, tc, rotation);\r\n\r\n      if (lon % 45 === 0) {\r\n        ctx.font = \"bold 24px Arial, Helvetica, sans-serif\";\r\n        ctx.textBaseline = 'bottom';\r\n\r\n        const i = lon / 45;\r\n        const text = `${direction[i]}`;\r\n\r\n        tc = [x0 + dy * offset, y0 - dx * offset];\r\n        drawRotatedText(ctx, text, tc, rotation);\r\n\r\n        [ x0, y0 ] = n45[i * 2];\r\n        [ x1, y1 ] = n45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n\r\n        [ x0, y0 ] = s45[i * 2];\r\n        [ x1, y1 ] = s45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayAzimuth;","import createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\nimport state from './state.js';\r\n\r\nconst { atan2, abs } = Math;\r\n\r\nconst overlayAltitude = () => {\r\n  const { canvasContext: ctx } = state;\r\n  const { polarToScreen, screenToPolar } = createTransformer();\r\n\r\n  const [ longitude ] = screenToPolar([ ctx.canvas.width * 0.5, ctx.canvas.height * 0.5 ]);\r\n  const altitude = [];\r\n\r\n  for (let lat = -90; lat <= 90; lat++) {\r\n    altitude.push(polarToScreen([longitude, lat]));\r\n  }\r\n  \r\n  ctx.save();\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.beginPath();\r\n  ctx.moveTo(...altitude[0]);\r\n\r\n  for (let i = 1; i < altitude.length; i++) {\r\n    ctx.lineTo(...altitude[i]);\r\n  }\r\n\r\n  ctx.stroke();    \r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n  ctx.textAlign = 'left';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  for (let lat = -89, i = 1; lat <= 89; lat++, i++) {\r\n    const [ x0, y0 ] = altitude[i];\r\n    const [ x1, y1 ] = altitude[i - 1];\r\n    const dx = x0 - x1;\r\n    const dy = y0 - y1;\r\n\r\n    const major = lat % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n\r\n    if (major && lat) {\r\n      const offset = 1.5;\r\n      const rotation = atan2(dx, -dy);\r\n      const tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${abs(lat)}`, tc, rotation);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayAltitude;","\r\nconst NAME = 'landmarks';\r\nlet database;\r\n\r\nconst getDatabase = () => new Promise((resolve, reject) => {\r\n  if (database) {\r\n    resolve(database);\r\n  }\r\n\r\n  const request = window.indexedDB.open(NAME, 1);\r\n  request.onsuccess = () => {\r\n    database = request.result;\r\n    resolve(database);\r\n  }\r\n  request.onupgradeneeded = () => request.result.createObjectStore(NAME, { \r\n    keyPath: 'key',\r\n    autoIncrement: true\r\n  });\r\n  request.onerror = reject;\r\n});\r\n\r\nconst getObjectStore = (mode = 'readonly') => new Promise((resolve, reject) => {\r\n  getDatabase().then((db) => {\r\n    const transaction = db.transaction([NAME], mode);\r\n    const objectStore = transaction.objectStore(NAME);\r\n    resolve(objectStore);  \r\n  })\r\n  .catch(reject);\r\n});\r\n\r\nconst getAll = () => new Promise((resolve, reject) => {\r\n  getObjectStore().then((objectStore) => {\r\n    const request = objectStore.getAll();\r\n    request.onsuccess = () => resolve(request.result);\r\n    request.onerror = reject;\r\n  })\r\n  .catch(reject);\r\n});\r\n\r\nconst put = (landmark) => new Promise((resolve, reject) => {\r\n  getObjectStore('readwrite').then((objectStore) => {\r\n    const request = objectStore.put(landmark);\r\n    request.onsuccess = () => {\r\n      objectStore.transaction.commit();\r\n      resolve(request.result);\r\n    }\r\n    request.onerror = reject;\r\n  })\r\n  .catch(reject);\r\n});\r\n\r\nconst remove = (key) => new Promise((resolve, reject) => {\r\n  getObjectStore('readwrite').then((objectStore) => {\r\n    const request = objectStore.delete(key);\r\n    request.onsuccess = () => {\r\n      objectStore.transaction.commit();\r\n      resolve();\r\n    }\r\n    request.onerror = reject;\r\n  })\r\n  .catch(reject);\r\n});\r\n\r\nexport default { getAll, put, remove }","import landmarkDb from './landmark-db.js';\r\n\r\nconst landmarks = await landmarkDb.getAll();\r\n\r\nconst get = (key) => landmarks.find((lm) => lm.key === key);\r\n\r\nconst getAll = () => landmarks.toSorted((a, b) => a.name > b.name ? 1 : (a.name < b.name ? -1 : 0));\r\n\r\nconst getVisible = () => landmarks.filter((lm) => lm.visible);\r\n\r\nconst put = async (landmark) => {\r\n  const key = await landmarkDb.put(landmark);\r\n  const i = landmarks.findIndex((lm) => lm.key === key);\r\n\r\n  if (i === -1) {\r\n    landmark.key = key;\r\n    landmarks.push(landmark);\r\n  }\r\n  else {\r\n    landmarks[i] = landmark;\r\n  }\r\n};\r\n\r\nconst remove = async (key) => {\r\n  const i = landmarks.findIndex((lm) => lm.key === key);\r\n\r\n  if (i >= 0) {\r\n    landmarks.splice(i, 1);\r\n    await landmarkDb.remove(key);\r\n  }\r\n};\r\n\r\nexport default { get, getAll, getVisible, put, remove };","// sources\r\n//   https://en.wikipedia.org/wiki/Great-circle_distance, first formula, spherical law of cosines\r\n//   https://en.wikipedia.org/wiki/Azimuth#In_geodesy\r\n\r\nimport { deg, rad, rev } from './angle.js';\r\n\r\nconst { abs, cos, sin, tan, acos, atan2, PI } = Math;\r\n\r\nconst radius = 6371008.8;\r\nconst EPSILON = 0.000000001;  // radians\r\n\r\nconst distanceAzimuth = (p1, p2) => {\r\n  const { longitude: lon1, latitude: lat1 } = p1;\r\n  const { longitude: lon2, latitude: lat2 } = p2;\r\n\r\n  const λ1 = rad(lon1);\r\n  const φ1 = rad(lat1);\r\n  const λ2 = rad(lon2);\r\n  const φ2 = rad(lat2);\r\n  const Δλ = λ2 - λ1;\r\n\r\n  const coincident = abs(Δλ) < EPSILON && abs(φ2 - φ1) < EPSILON;\r\n  const antipodal = !coincident && abs(abs(Δλ) - PI) < EPSILON && abs(φ1 + φ2) < EPSILON;\r\n\r\n  if (coincident || antipodal) {\r\n    return {};\r\n  }\r\n\r\n  const cosφ1 = cos(φ1);\r\n  const sinφ1 = sin(φ1);\r\n  const cosφ2 = cos(φ2);\r\n  const sinφ2 = sin(φ2);\r\n  const tanφ2 = tan(φ2);\r\n  const cosΔλ = cos(Δλ);\r\n  const sinΔλ = sin(Δλ);\r\n\r\n  const distance = radius * acos(sinφ1 * sinφ2 + cosφ1 * cosφ2 *  cosΔλ);\r\n  const azimuth = rev(deg(atan2(sinΔλ, cosφ1 * tanφ2 - sinφ1 * cosΔλ)));\r\n\r\n  return { distance, azimuth };\r\n};\r\n\r\nexport default distanceAzimuth;\r\n","import landmarkStore from './landmark-store.js';\r\nimport createTransformer from './create-transformer.js';\r\nimport distanceAzimuth from './distance-azimuth-sphere.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\nimport { deg } from './angle.js';\r\nimport state from './state.js';\r\n\r\nconst { sqrt, atan2, PI } = Math;\r\n\r\nconst MIN_DISTANCE = 10;  // meters; landmark must be beyond this distance to be visible\r\nconst MAX_ALTITUDE_DISTANCE = 50000;  // meters; landmark must be within this distance to be plotted with an altitude\r\nconst METERS_PER_FOOT = 0.3048;\r\nconst FEET_PER_MILE = 5280;\r\n\r\nconst overlayMarks = () => {\r\n  const landmarks = landmarkStore.getVisible();\r\n\r\n  if (!landmarks.length) {\r\n    return;\r\n  }\r\n\r\n  const { canvasContext: ctx } = state;\r\n  const { polarToScreen } = createTransformer();\r\n  const { coords } = state.location;\r\n  const numberFormat = new Intl.NumberFormat(undefined, { maximumSignificantDigits: 3 });\r\n\r\n  ctx.save();\r\n\r\n  ctx.font = \"bold 24px Arial, Helvetica, sans-serif\";\r\n  ctx.textAlign = 'left';\r\n  ctx.textBaseline = 'bottom';\r\n  ctx.shadowColor = '#000000';\r\n\r\n  landmarks.forEach((lm) => {\r\n    let { distance, azimuth } = distanceAzimuth(coords, lm);\r\n\r\n    if (distance && distance >= MIN_DISTANCE) {\r\n      ctx.save();\r\n\r\n      let altitude = 0;\r\n\r\n      if (lm.elevation !== undefined && distance <= MAX_ALTITUDE_DISTANCE) {\r\n        const Δelevation = lm.elevation - coords.altitude;\r\n        altitude = deg(atan2(Δelevation, distance));\r\n        distance = sqrt(distance * distance + Δelevation * Δelevation);\r\n      }\r\n\r\n      const [ x0, y0 ] = polarToScreen([azimuth, altitude]);\r\n      const [ x1, y1 ] = polarToScreen([azimuth + 1, altitude]);\r\n\r\n      const dx = x1 - x0;\r\n      const dy = y1 - y0;\r\n\r\n      ctx.translate(x0, y0);\r\n      ctx.rotate(atan2(dy, dx));\r\n\r\n      ctx.fillStyle = '#ffff8080';\r\n      ctx.strokeStyle = '#ffff80';\r\n      ctx.fillRect(-10, -10, 20, 20);\r\n      ctx.strokeRect(-10, -10, 20, 20);\r\n\r\n      let measure;\r\n\r\n      if (state.units === 'US/Imperial') {\r\n        distance /= METERS_PER_FOOT;\r\n        measure = distance < FEET_PER_MILE ? `${numberFormat.format(distance)} ft` : `${numberFormat.format(distance / FEET_PER_MILE)} mi`;\r\n      }\r\n      else {\r\n        measure = distance < 1000 ? `${numberFormat.format(distance)} m` : `${numberFormat.format(distance * 0.001)} km`;\r\n      }\r\n\r\n      ctx.fillStyle = '#ffff80';\r\n      ctx.shadowBlur = 5;\r\n      ctx.fillText(lm.name, 20, -26);\r\n      ctx.fillText(measure, 20, 6);\r\n\r\n      ctx.restore();\r\n    }\r\n  });\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayMarks;","import overlayGraticule from './overlay-graticule.js';\r\nimport overlayAzimuth from './overlay-azimuth.js';\r\nimport overlayAltitude from './overlay-altitude.js';\r\nimport overlayLandmarks from './overlay-landmarks.js';\r\nimport dom from './dom.js';\r\nimport state from './state.js';\r\n\r\nconst FRAMES_PER_SECOND = 30;\r\n\r\nconst initialize = () => {\r\n  const canvas = document.querySelector('canvas');\r\n  canvas.width = window.innerWidth;\r\n  canvas.height = window.innerHeight;\r\n\r\n  const ctx = canvas.getContext('2d');\r\n  state.canvasContext = ctx;\r\n\r\n  const fpsInterval = 1000 / FRAMES_PER_SECOND;\r\n\r\n  let animationFrameHandle;\r\n  let lastUpdated = performance.now();\r\n\r\n  const update = () => {\r\n    animationFrameHandle = requestAnimationFrame(update);\r\n    \r\n    const now = performance.now();\r\n    const elapsed = now - lastUpdated;\r\n\r\n    if (elapsed < fpsInterval) {\r\n      return;\r\n    }\r\n\r\n    if (state.rotationMatrix) {\r\n      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);\r\n      overlayGraticule();\r\n      overlayAltitude();\r\n      overlayAzimuth();\r\n      overlayLandmarks();\r\n    }\r\n\r\n    lastUpdated = now;\r\n  };\r\n\r\n  update();\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (animationFrameHandle === undefined) {\r\n        lastUpdated = performance.now();\r\n        update();\r\n      }\r\n    }\r\n    else {\r\n      if (animationFrameHandle !== undefined) {\r\n        cancelAnimationFrame(animationFrameHandle);\r\n        animationFrameHandle = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","import dom from './dom.js';\r\n\r\nconst initialize = async (state) => {\r\n  const permission = await navigator.permissions.query({ name: 'screen-wake-lock' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return;\r\n  }\r\n\r\n  let wakeLock;\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!wakeLock) {\r\n        wakeLock = await navigator.wakeLock.request('screen');\r\n        wakeLock.addEventListener('release', () => {\r\n          wakeLock = undefined;\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      if (wakeLock) {\r\n        wakeLock.release();\r\n      }\r\n    }\r\n  };\r\n  \r\n  await visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n}\r\n\r\nexport default { initialize };\r\n","import landmarkStore from './landmark-store.js';\r\nimport dom from './dom.js';\r\nimport state from './state.js';\r\n\r\nconst initialize = () => {\r\n  const $create = dom.get('lm-create');\r\n  const $show = dom.get('lm-show-list');\r\n\r\n  const $listModal = dom.get('lm-list-modal');\r\n  const $listContainer = dom.get('lm-list-container');\r\n  const $listClose = dom.get('lm-list-close');\r\n\r\n  const $editModal = dom.get('lm-edit-modal');\r\n  const $editForm = dom.get('lm-edit-form');\r\n  const $editKey = dom.get('lm-edit-key');\r\n  const $editName = dom.get('lm-edit-name');\r\n  const $editLat = dom.get('lm-edit-lat');\r\n  const $editLon = dom.get('lm-edit-lon');\r\n  const $editElev = dom.get('lm-edit-elev');\r\n  const $editVis = dom.get('lm-edit-vis');\r\n  const $editConfirm = dom.get('lm-edit-confirm');\r\n  const $editCancel = dom.get('lm-edit-cancel');\r\n\r\n  const $removeModal = dom.get('lm-remove-modal');\r\n  const $removeKey = dom.get('lm-remove-key');\r\n  const $removeName = dom.get('lm-remove-name');\r\n  const $removeConfirm = dom.get('lm-remove-confirm');\r\n  const $removeCancel = dom.get('lm-remove-cancel');\r\n\r\n  const startCreate = () => {\r\n    const { latitude, longitude, altitude } = state.location.coords;\r\n\r\n    $editKey.value = '';\r\n    $editName.value = '';\r\n    $editLat.value = latitude.toFixed(6);\r\n    $editLon.value = longitude.toFixed(6);\r\n    $editElev.value = altitude.toFixed(0);\r\n    $editVis.value = true;\r\n\r\n    $editModal.showModal();\r\n  };\r\n\r\n  dom.on($create, 'click', startCreate);\r\n\r\n  const changeVisibility = async (key, $listVis) => {\r\n    const landmark = landmarkStore.get(key);\r\n    landmark.visible = !landmark.visible;\r\n    await landmarkStore.put(landmark);\r\n    $listVis.className = 'visibility ' + (landmark.visible ? 'visible' : 'hidden');\r\n  };\r\n\r\n  const startEdit = (key) => {\r\n    const { name, latitude, longitude, elevation, visible } = landmarkStore.get(key);\r\n\r\n    $editKey.value = key;\r\n    $editName.value = name;\r\n    $editLat.value = latitude.toFixed(6);\r\n    $editLon.value = longitude.toFixed(6);\r\n    $editElev.value = elevation?.toFixed(0);\r\n    $editVis.value = visible;\r\n\r\n    $editModal.showModal();\r\n  };\r\n\r\n  const startRemove = (key) => {\r\n    const { name } = landmarkStore.get(key);\r\n    $removeKey.value = key;\r\n    $removeName.innerHTML = `Delete ${name}?`;\r\n    $removeModal.showModal();\r\n  };\r\n\r\n  const fillList = () => {\r\n    $listContainer.innerHTML = '';\r\n    const landmarks = landmarkStore.getAll();\r\n\r\n    landmarks.forEach((lm) => {\r\n      const className = 'visibility ' + (lm.visible ? 'visible' : 'hidden');\r\n      const $listVis = dom.create('button', { className });\r\n      dom.on($listVis, 'click', () => changeVisibility(lm.key, $listVis));\r\n\r\n      const $listName = dom.create('span', lm.name);\r\n\r\n      const $listEdit = dom.create('button', { className: 'edit' });\r\n      dom.on($listEdit, 'click', () => startEdit(lm.key));\r\n\r\n      const $listRemove = dom.create('button', { className: 'remove' });\r\n      dom.on($listRemove, 'click', () => startRemove(lm.key));\r\n\r\n      dom.add($listContainer, dom.create('div', [$listVis, $listName, $listEdit, $listRemove]));\r\n    });\r\n  };\r\n\r\n  const showList = () => {\r\n    fillList();\r\n    $listModal.showModal();\r\n  };\r\n\r\n  dom.on($show, 'click', showList);\r\n\r\n  const saveEdits = async () => {\r\n    if (!$editForm.checkValidity()) {\r\n      return;\r\n    }\r\n\r\n    const wasEdited = !!$editKey.value;\r\n\r\n    const name = $editName.value;\r\n    const latitude = parseFloat($editLat.value);\r\n    const longitude = parseFloat($editLon.value);\r\n    const elevation = $editElev.value ? parseFloat($editElev.value) : undefined;\r\n    const visible = $editVis.value === 'true';\r\n\r\n    const landmark = { name, latitude, longitude, elevation, visible };\r\n\r\n    if (wasEdited) {\r\n      landmark.key = parseInt($editKey.value, 10);\r\n    }\r\n\r\n    await landmarkStore.put(landmark);\r\n\r\n    if (wasEdited) {\r\n      fillList();\r\n    }\r\n\r\n    $editModal.close();\r\n  };\r\n\r\n  dom.on($editConfirm, 'click', saveEdits);\r\n\r\n  const remove = async () => {\r\n    const key = parseInt($removeKey.value, 10);\r\n    await landmarkStore.remove(key);\r\n    fillList();\r\n    $removeModal.close();\r\n  };\r\n\r\n  dom.on($removeConfirm, 'click', remove);\r\n\r\n  // cancel/close dialogs\r\n\r\n  dom.on([$listClose, $editCancel, $removeCancel], 'click', (event) => event.target.closest('dialog').close());\r\n\r\n  dom.on([$listModal, $editModal, $removeModal], 'click', (event) => {\r\n    if (event.target instanceof HTMLDialogElement) {\r\n      event.target.close();\r\n    }\r\n  });\r\n};\r\n\r\nexport default { initialize };","import environment from './environment.js';\r\nimport dom from './dom.js';\r\nimport video from './video.js';\r\nimport location from './location.js';\r\nimport orientation from './orientation.js';\r\nimport overlay from './overlay.js';\r\nimport wakeLock from './wake-lock.js';\r\nimport landmarkManager from './landmark-manager.js';\r\n\r\n(async () => {\r\n  const $init = dom.find('#init')[0];\r\n  $init.style.setProperty('display', 'block');  \r\n\r\n  // initialize the video from the device's front-facing camera\r\n\r\n  $init.innerHTML = 'Starting camera and video ...';\r\n\r\n  let error = await video.initialize();\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the user's location including magentic declination\r\n  \r\n  $init.innerHTML = 'Getting device location, please wait ...';\r\n\r\n  error = await location.initialize();\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the orientation sensor\r\n\r\n  error = orientation.initialize();\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the landmark manager\r\n\r\n  landmarkManager.initialize();\r\n\r\n  // initialize the overlays\r\n\r\n  $init.style.setProperty('display', 'none');\r\n\r\n  overlay.initialize();\r\n  \r\n  // only in development: keep screen active while in use\r\n\r\n  if (environment === 'development') {\r\n    wakeLock.initialize();\r\n  }\r\n})();\r\n"],"names":["environment","URL","document","location","href","hostname","toArray","target","Array","HTMLElement","HTMLDocument","HTMLCollection","from","add","children","elements","Error","forEach","c","appendChild","each","action","e","isContent","x","constructor","name","dom","tagName","args","element","createElement","properties","find","a","Object","assign","content","innerHTML","selector","pop","length","querySelectorAll","id","getElementById","type","handler","addEventListener","videoOptions","video","facingMode","exact","width","ideal","window","innerHeight","height","innerWidth","getVideoStream","async","stream","navigator","mediaDevices","getUserMedia","permissions","query","state","$videoContainer","$video","visibilityChangeHandler","visibilityState","autoplay","mute","srcObject","getTracks","t","stop","remove","undefined","radiansPerDegree","Math","PI","degreesPerRadian","rad","deg","rev","angle","array","n","v","isFunction","Function","i","sqrt","sin","cos","atan2","abs","cd","tc","dp","snorm","sp","cp","fn","fm","pp","k","p","b","a2","b2","c2","a4","c4","epoch","model","m","gnm","hnm","dgnm","dhnm","coefficients","j","D2","flnmj","geomag","date","latitude","glat","longitude","glon","altitude","alt","year","Date","getUTCFullYear","msInYear","valueOf","UTC","decimalYear","dt","rlat","rlon","srlon","srlat","crlon","crlat","srlat2","crlat2","q","q1","ct","st","r","d","ca","sa","aor","ar","br","bt","bp","bpp","D4","par","temp1","temp2","parp","bx","by","bz","bh","ti","dec","dip","gv","declination","inclination","intensity","gridVariation","scale","rotationMatrix","canvasContext","getLocation","promise","Promise","resolve","reject","geolocation","getCurrentPosition","coords","intervalHandle","setInterval","clearInterval","cosSin","matrix","matrices","y","z","w","f","g","h","a1","b1","c1","det","sign","asin","HALF_PI","orientation","AbsoluteOrientationSensor","sensor","frequency","onreading","qx","qy","qz","qw","quaternion","xr","ysin","yr","zr","start","toRectangular","projection","factor","x2y2","createTransformer","ctx","xOffset","canvas","clientWidth","yOffset","clientHeight","inverseRotationMatrix","rectangularToScreen","screenToRectangular","polarToScreen","screenToPolar","toPolar","graticule","lon","coordinates","lat","push","drawRotatedText","text","origin","rotation","offset","save","translate","rotate","fillText","restore","baseHorizon","baseN45","baseS45","direction","NAME","database","getObjectStore","mode","request","indexedDB","open","onsuccess","result","onupgradeneeded","createObjectStore","keyPath","autoIncrement","onerror","then","db","objectStore","transaction","catch","landmarkDb","getAll","landmark","put","commit","key","delete","landmarks","landmarkStore","lm","toSorted","filter","visible","findIndex","splice","tan","acos","EPSILON","overlayMarks","numberFormat","Intl","NumberFormat","maximumSignificantDigits","font","textAlign","textBaseline","shadowColor","distance","azimuth","p1","p2","lon1","lat1","lon2","lat2","coincident","antipodal","distanceAzimuth","elevation","x0","y0","x1","y1","dx","dy","measure","fillStyle","strokeStyle","fillRect","strokeRect","format","shadowBlur","overlay","querySelector","getContext","fpsInterval","animationFrameHandle","lastUpdated","performance","now","update","requestAnimationFrame","clearRect","lineWidth","map","beginPath","moveTo","lineTo","stroke","overlayGraticule","major","len","overlayAltitude","horizon","n45","s45","overlayAzimuth","overlayLandmarks","cancelAnimationFrame","wakeLock","release","landmarkManager","$create","$show","$listModal","$listContainer","$listClose","$editModal","$editForm","$editKey","$editName","$editLat","$editLon","$editElev","$editVis","$editConfirm","$editCancel","$removeModal","$removeKey","$removeName","$removeConfirm","$removeCancel","value","toFixed","showModal","fillList","className","$listVis","changeVisibility","$listName","$listEdit","startEdit","$listRemove","startRemove","checkValidity","wasEdited","parseFloat","parseInt","close","event","closest","HTMLDialogElement","$init","style","setProperty","error"],"mappings":"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"}