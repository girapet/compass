{"version":3,"file":"index.js","sources":["../dom.js","../video.js","../angle.js","../array.js","../geomag.js","../magnetic-model.js","../location.js","../3d-rotation-matrix.js","../orientation.js","../coordinate-conversion.js","../stereographic-projection.js","../create-transformer.js","../overlay-graticule.js","../draw-rotated-text.js","../overlay-azimuth.js","../overlay-altitude.js","../distance-azimuth-sphere.js","../overlay-marks.js","../overlay.js","../wake-lock.js","../mark-manager.js","../index.js"],"sourcesContent":["\r\nconst toArray = (target) => {\r\n  if (target instanceof Array) {\r\n    return target;\r\n  }\r\n  else if (target instanceof HTMLElement || target instanceof HTMLDocument) {\r\n    return [target];\r\n  }\r\n  else if (target instanceof HTMLCollection) {\r\n    return Array.from(target);\r\n  }\r\n};\r\n\r\nexport const add = (target, children) => {\r\n  const elements = toArray(children);\r\n \r\n  if (!elements) {\r\n    throw new Error('invalid child elements');\r\n  }\r\n\r\n  elements.forEach((c) => target.appendChild(c));\r\n};\r\n\r\nexport const each = (target, action) => {\r\n  const elements = toArray(target);\r\n \r\n  if (!elements) {\r\n    throw new Error('invalid target');\r\n  }\r\n\r\n  elements.forEach((e) => action(e));\r\n};\r\n\r\nconst isContent = (x) => x.constructor.name === 'String' || \r\n  x instanceof Array || \r\n  x instanceof HTMLElement || \r\n  x instanceof HTMLCollection;\r\n\r\nexport const create = (tagName, ...args) => {\r\n  const element = document.createElement(tagName);\r\n\r\n  const properties = args.find((a) => !isContent(a));\r\n\r\n  if (properties) {\r\n    Object.assign(element, properties);\r\n  }\r\n\r\n  const content = args.find(isContent);\r\n\r\n  if (content) {\r\n    if (content.constructor.name === 'String') {\r\n      element.innerHTML = content;\r\n    }\r\n    else {\r\n      add(element, content);\r\n    }\r\n  }\r\n\r\n  return element;\r\n};\r\n\r\nexport const find = (...args) => {\r\n  const selector = args.pop();\r\n  const target = args.length ? args[0] : document;\r\n  return Array.from(target.querySelectorAll(selector));\r\n}\r\n\r\nexport const get = (id) => document.getElementById(id);\r\n\r\nexport const on = (target, type, handler) => each(target, (e) => e.addEventListener(type, handler));\r\n\r\nexport const style = (target, styles) => each(target, (e) => {\r\n  Object.entries(styles).forEach((s) => {\r\n    const [ name, value ] = s;\r\n    e.style[name] = value;\r\n  });\r\n});\r\n\r\nexport default { add, create, each, find, get, on, style };","import dom from './dom.js';\r\n\r\nconst videoOptions = {\r\n  video: { \r\n    facingMode: { exact: 'environment' },\r\n    width: { ideal: window.innerHeight },\r\n    height: { ideal: window.innerWidth }\r\n  }\r\n};\r\n\r\nconst getVideoStream = async () => {\r\n  let stream;\r\n\r\n  try {\r\n    stream = await navigator.mediaDevices.getUserMedia(videoOptions);\r\n  }\r\n  catch {}\r\n\r\n  return stream;\r\n};\r\n\r\nconst initialize = async () => {\r\n  if (!navigator.mediaDevices) {\r\n    return 'No camera available';\r\n  }\r\n\r\n  const permission = await navigator.permissions.query({ name: 'camera' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return 'Permission to use this device\\'s camera was denied';\r\n  }\r\n\r\n  let stream = await getVideoStream();\r\n\r\n  if (!stream) {\r\n    return 'No front-facing camera available';\r\n  }\r\n\r\n  const $videoContainer = dom.get('video-container');\r\n  let $video;\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!$video) {\r\n        if (!stream) {\r\n          stream = await getVideoStream();\r\n        }\r\n\r\n        $video = dom.create('video', { \r\n          autoplay: true,\r\n          mute: true\r\n        });\r\n        dom.add($videoContainer, $video);\r\n        $video.srcObject = stream;\r\n      }\r\n    }\r\n    else {\r\n      if ($video) {\r\n        $video.srcObject.getTracks().forEach((t) => t.stop());\r\n        $video.remove();\r\n        $video = undefined;\r\n        stream = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  await visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","\r\nconst radiansPerDegree = Math.PI / 180;\r\nconst degreesPerRadian = 1 / radiansPerDegree;\r\n\r\nexport const rad = (x) => x * radiansPerDegree;\r\nexport const deg = (x) => x * degreesPerRadian;\r\n\r\nexport const rev = (x) => {\r\n  x = x % 360;\r\n  return x >= 0 ? x : x + 360;\r\n};\r\n\r\nexport default { rad, deg, rev }\r\n\r\n","\r\n// creates a new array of size n filled with value v; the value can also be a function \r\n// that returns a value\r\n\r\nconst array = (n, v) => {\r\n  const a = new Array(n);\r\n\r\n  if (v !== undefined) {\r\n    const isFunction = v instanceof Function;\r\n\r\n    for (let i = 0; i < n; i++) {\r\n      a[i] = isFunction ? v() : v;\r\n    }\r\n  }\r\n\r\n  return a;\r\n};\r\n\r\nexport default array;","// adapted from https://github.com/cmweiss/geomagJS/blob/master/geomag.js\r\n// World Magnetic Model: https://www.ncei.noaa.gov/products/world-magnetic-model\r\n\r\nimport magneticModel from './magnetic-model.js';\r\nimport { rad, deg } from './angle.js';\r\nimport array from './array.js';\r\n\r\nconst { sqrt, sin, cos, atan2, abs } = Math;\r\n\r\nconst c = array(13, () => array(13));\r\nconst cd = array(13, () => array(13));\r\nconst tc = array(13, () => array(13));\r\nconst dp = array(13, () => array(13));\r\nconst snorm = array(13, () => array(13));\r\nconst sp = array(13);\r\nconst cp = array(13);\r\nconst fn = array(13);\r\nconst fm = array(13);\r\nconst pp = array(13);\r\nconst k = array(13, () => array(13));\r\nconst p = array(13, () => array(13));\r\n\r\nconst maxord = 12;\r\n\r\nsp[0] = 0;\r\ncp[0] = 1;\r\np[0][0] = 1;\r\npp[0] = 1;\r\ndp[0][0] = 0;\r\n\r\nconst a = 6378.137;\r\nconst b = 6356.7523142;\r\nconst re = 6371.2;\r\nconst a2 = a * a;\r\nconst b2 = b * b;\r\nconst c2 = a2 - b2;\r\nconst a4 = a2 * a2;\r\nconst b4 = b2 * b2;\r\nconst c4 = a4 - b4;\r\n\r\n// read World Magnetic Model spherical harmonic coefficients\r\n\r\nc[0][0] = 0;\r\ncd[0][0] = 0;\r\n\r\nconst { epoch, model } = magneticModel;\r\n\r\nmodel.forEach((coefficients) => {\r\n  const { n, m, gnm, hnm, dgnm , dhnm } = coefficients;\r\n\r\n  if (m <= n) {\r\n    c[m][n] = gnm;\r\n    cd[m][n] = dgnm;\r\n    \r\n    if (m !== 0) {\r\n      c[n][m - 1] = hnm;\r\n      cd[n][m - 1] = dhnm;\r\n    }\r\n  }\r\n});\r\n\r\n// convert Schmidt normalized Gauss coefficients to unnormalized\r\n\r\nsnorm[0][0] = 1;\r\nfm[0] = 0;\r\n\r\nfor (let n = 1; n <= maxord; n++) {\r\n  snorm[0][n] = snorm[0][n - 1] * (2 * n - 1) / n;\r\n  let j = 2;\r\n\r\n  for (let m = 0, D2 = n - m + 1; D2 > 0; D2--, m++) {\r\n    k[m][n] = (((n - 1) * (n - 1)) - (m * m)) / ((2 * n - 1) * (2 * n - 3));\r\n\r\n    if (m > 0) {\r\n      const flnmj = ((n - m + 1) * j) / (n + m);\r\n      snorm[m][n] = snorm[m - 1][n] * sqrt(flnmj);\r\n      j = 1;\r\n      c[n][m - 1] = snorm[m][n] * c[n][m - 1];\r\n      cd[n][m - 1] = snorm[m][n] * cd[n][m - 1];\r\n    }\r\n\r\n    c[m][n] = snorm[m][n] * c[m][n];\r\n    cd[m][n] = snorm[m][n] * cd[m][n];\r\n  }\r\n\r\n  fn[n] = n + 1;\r\n  fm[n] = n;\r\n}\r\n\r\nk[1][1] = 0.0;\r\n\r\nconst decimalYear = (date) => {\r\n  date = date || new Date();\r\n  const year = date.getUTCFullYear();\r\n  const daysInYear = 365 + (((year % 400 === 0) || (year % 4 === 0 && (year % 100 > 0))) ? 1 : 0);\r\n  const msInYear = daysInYear * 24 * 60 * 60 * 1000;\r\n  return year + (date.valueOf() - Date.UTC(year, 0)) / msInYear;\r\n};\r\n\r\nconst geomag = (location, date) => {\r\n  const { latitude: glat, longitude: glon, altitude: alt } = location;\r\n  const year = decimalYear(date);\r\n  \r\n  const dt = year - epoch;\r\n  const rlat = rad(glat);\r\n  const rlon = rad(glon);\r\n  const srlon = sin(rlon);\r\n  const srlat = sin(rlat);\r\n  const crlon = cos(rlon);\r\n  const crlat = cos(rlat);\r\n  const srlat2 = srlat * srlat;\r\n  const crlat2 = crlat * crlat;\r\n\r\n  sp[1] = srlon;\r\n  cp[1] = crlon;\r\n\r\n  // convert from geodetic to spherical coordinates\r\n\r\n  const q = sqrt(a2 - c2 * srlat2);\r\n  const q1 = alt * q;\r\n  const q2 = ((q1 + a2) / (q1 + b2)) * ((q1 + a2) / (q1 + b2));\r\n  const ct = srlat / sqrt(q2 * crlat2 + srlat2);\r\n  const st = sqrt(1 - (ct * ct));\r\n  const r2 = (alt * alt) + 2 * q1 + (a4 - c4 * srlat2) / (q * q);\r\n  const r = sqrt(r2);\r\n  const d = sqrt(a2 * crlat2 + b2 * srlat2);\r\n  const ca = (alt + d) / r;\r\n  const sa = c2 * crlat * srlat / (r * d);\r\n\r\n  for (let m = 2; m <= maxord; m++) {\r\n    sp[m] = sp[1] * cp[m - 1] + cp[1] * sp[m - 1];\r\n    cp[m] = cp[1] * cp[m - 1] - sp[1] * sp[m - 1];\r\n  }\r\n\r\n  const aor = re / r;\r\n  let ar = aor * aor;\r\n  let br = 0;\r\n  let bt = 0;\r\n  let bp = 0;\r\n  let bpp = 0;\r\n\r\n  for (let n = 1; n <= maxord; n++) {\r\n    ar = ar * aor;\r\n    \r\n    for (let m = 0, D4 = n + m + 1; D4 > 0; D4--, m++) {\r\n\r\n      // compute unnormalized associated Legendre polynomials and derivatives via recursion relations\r\n\r\n      if (n === m) {\r\n        p[m][n] = st * p[m - 1][n - 1];\r\n        dp[m][n] = st * dp[m - 1][n - 1] + ct * p[m - 1][n - 1];\r\n      } \r\n      else if (n === 1 && m === 0) {\r\n        p[m][n] = ct * p[m][n - 1];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1];\r\n      } \r\n      else if (n > 1 && n !== m) {\r\n        if (m > n - 2) { \r\n          p[m][n - 2] = 0; \r\n        }\r\n        \r\n        if (m > n - 2) { \r\n          dp[m][n - 2] = 0; \r\n        }\r\n        \r\n        p[m][n] = ct * p[m][n - 1] - k[m][n] * p[m][n - 2];\r\n        dp[m][n] = ct * dp[m][n - 1] - st * p[m][n - 1] - k[m][n] * dp[m][n - 2];\r\n      }\r\n\r\n      // time adjust the Gauss coefficients\r\n\r\n      tc[m][n] = c[m][n] + dt * cd[m][n];\r\n\r\n      if (m !== 0) {\r\n        tc[n][m - 1] = c[n][m - 1] + dt * cd[n][m - 1];\r\n      }\r\n\r\n      // accumulate terms of the spherical harmonic expansions\r\n\r\n      const par = ar * p[m][n];\r\n      let temp1, temp2;\r\n\r\n      if (m === 0) {\r\n        temp1 = tc[m][n] * cp[m];\r\n        temp2 = tc[m][n] * sp[m];\r\n      } \r\n      else {\r\n        temp1 = tc[m][n] * cp[m] + tc[n][m - 1] * sp[m];\r\n        temp2 = tc[m][n] * sp[m] - tc[n][m - 1] * cp[m];\r\n      }\r\n\r\n      bt = bt - ar * temp1 * dp[m][n];\r\n      bp += fm[m] * temp2 * par;\r\n      br += fn[n] * temp1 * par;\r\n\r\n      // special case: north/south geographic poles\r\n\r\n      if (st === 0 && m === 1) {\r\n        if (n === 1) {\r\n          pp[n] = pp[n - 1];\r\n        } \r\n        else {\r\n          pp[n] = ct * pp[n - 1] - k[m][n] * pp[n - 2];\r\n        }\r\n\r\n        const parp = ar * pp[n];\r\n        bpp += (fm[m] * temp2 * parp);\r\n      }\r\n    }\r\n  }\r\n\r\n  bp = st === 0 ? bpp : bp / st;\r\n\r\n  // rotate magnetic vector components from spherical to geodetic coordinates\r\n\r\n  const bx = -bt * ca - br * sa;\r\n  const by = bp;\r\n  const bz = bt * sa - br * ca;\r\n\r\n  // compute declination (dec), inclination (dip) and total intensity (ti)\r\n\r\n  const bh = sqrt((bx * bx) + (by * by));\r\n  const ti = sqrt((bh * bh) + (bz * bz));\r\n  const dec = deg(atan2(by, bx));\r\n  const dip = deg(atan2(bz, bh));\r\n\r\n  // compute magnetic grid variation if the current geodetic position is in the arctic or antarctic\r\n  // (i.e. glat > +55 degrees or glat < -55 degrees) otherwise, set magnetic grid variation to -999.0\r\n\r\n  let gv = -999;\r\n\r\n  if (abs(glat) >= 55) {\r\n    if (glat > 0 && glon >= 0) {\r\n       gv = dec - glon;\r\n    }\r\n\r\n    if (glat > 0 && glon < 0) {\r\n      gv =  dec + abs(glon);\r\n    }\r\n\r\n    if (glat < 0 && glon >= 0) {\r\n      gv = dec + glon;\r\n    }\r\n\r\n    if (glat < 0 && glon < 0) {\r\n      gv = dec - abs(glon);\r\n    }\r\n\r\n    if (gv > 180) {\r\n      gv -= 360;\r\n    }\r\n\r\n    if (gv < -180) {\r\n      gv += 360;\r\n    }\r\n  }\r\n\r\n  return { declination: dec, inclination: dip, intensity: ti, gridVariation: gv };\r\n  // return { declination: dec, inclination: dip, intensity: ti, gridVariation: gv, bx, by, bz, bh };\r\n};\r\n\r\nexport default geomag;","// generated by processing/convert-magnetic-model.js, do not edit\n\nexport default {\n  \"epoch\": 2025,\n  \"modelName\": \"WMM-2025\",\n  \"modelDate\": \"11/13/2024\",\n  \"model\": [\n    {\n      \"n\": 1,\n      \"m\": 0,\n      \"gnm\": -29351.8,\n      \"hnm\": 0,\n      \"dgnm\": 12,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 1,\n      \"m\": 1,\n      \"gnm\": -1410.8,\n      \"hnm\": 4545.4,\n      \"dgnm\": 9.7,\n      \"dhnm\": -21.5\n    },\n    {\n      \"n\": 2,\n      \"m\": 0,\n      \"gnm\": -2556.6,\n      \"hnm\": 0,\n      \"dgnm\": -11.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 2,\n      \"m\": 1,\n      \"gnm\": 2951.1,\n      \"hnm\": -3133.6,\n      \"dgnm\": -5.2,\n      \"dhnm\": -27.7\n    },\n    {\n      \"n\": 2,\n      \"m\": 2,\n      \"gnm\": 1649.3,\n      \"hnm\": -815.1,\n      \"dgnm\": -8,\n      \"dhnm\": -12.1\n    },\n    {\n      \"n\": 3,\n      \"m\": 0,\n      \"gnm\": 1361,\n      \"hnm\": 0,\n      \"dgnm\": -1.3,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 3,\n      \"m\": 1,\n      \"gnm\": -2404.1,\n      \"hnm\": -56.6,\n      \"dgnm\": -4.2,\n      \"dhnm\": 4\n    },\n    {\n      \"n\": 3,\n      \"m\": 2,\n      \"gnm\": 1243.8,\n      \"hnm\": 237.5,\n      \"dgnm\": 0.4,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 3,\n      \"m\": 3,\n      \"gnm\": 453.6,\n      \"hnm\": -549.5,\n      \"dgnm\": -15.6,\n      \"dhnm\": -4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 0,\n      \"gnm\": 895,\n      \"hnm\": 0,\n      \"dgnm\": -1.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 4,\n      \"m\": 1,\n      \"gnm\": 799.5,\n      \"hnm\": 278.6,\n      \"dgnm\": -2.4,\n      \"dhnm\": -1.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 2,\n      \"gnm\": 55.7,\n      \"hnm\": -133.9,\n      \"dgnm\": -6,\n      \"dhnm\": 4.1\n    },\n    {\n      \"n\": 4,\n      \"m\": 3,\n      \"gnm\": -281.1,\n      \"hnm\": 212,\n      \"dgnm\": 5.6,\n      \"dhnm\": 1.6\n    },\n    {\n      \"n\": 4,\n      \"m\": 4,\n      \"gnm\": 12.1,\n      \"hnm\": -375.6,\n      \"dgnm\": -7,\n      \"dhnm\": -4.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 0,\n      \"gnm\": -233.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 5,\n      \"m\": 1,\n      \"gnm\": 368.9,\n      \"hnm\": 45.4,\n      \"dgnm\": 1.4,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 5,\n      \"m\": 2,\n      \"gnm\": 187.2,\n      \"hnm\": 220.2,\n      \"dgnm\": 0,\n      \"dhnm\": 2.2\n    },\n    {\n      \"n\": 5,\n      \"m\": 3,\n      \"gnm\": -138.7,\n      \"hnm\": -122.9,\n      \"dgnm\": 0.6,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 5,\n      \"m\": 4,\n      \"gnm\": -142,\n      \"hnm\": 43,\n      \"dgnm\": 2.2,\n      \"dhnm\": 1.7\n    },\n    {\n      \"n\": 5,\n      \"m\": 5,\n      \"gnm\": 20.9,\n      \"hnm\": 106.1,\n      \"dgnm\": 0.9,\n      \"dhnm\": 1.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 0,\n      \"gnm\": 64.4,\n      \"hnm\": 0,\n      \"dgnm\": -0.2,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 6,\n      \"m\": 1,\n      \"gnm\": 63.8,\n      \"hnm\": -18.4,\n      \"dgnm\": -0.4,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 6,\n      \"m\": 2,\n      \"gnm\": 76.9,\n      \"hnm\": 16.8,\n      \"dgnm\": 0.9,\n      \"dhnm\": -1.6\n    },\n    {\n      \"n\": 6,\n      \"m\": 3,\n      \"gnm\": -115.7,\n      \"hnm\": 48.8,\n      \"dgnm\": 1.2,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 6,\n      \"m\": 4,\n      \"gnm\": -40.9,\n      \"hnm\": -59.8,\n      \"dgnm\": -0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 6,\n      \"m\": 5,\n      \"gnm\": 14.9,\n      \"hnm\": 10.9,\n      \"dgnm\": 0.3,\n      \"dhnm\": 0.7\n    },\n    {\n      \"n\": 6,\n      \"m\": 6,\n      \"gnm\": -60.7,\n      \"hnm\": 72.7,\n      \"dgnm\": 0.9,\n      \"dhnm\": 0.9\n    },\n    {\n      \"n\": 7,\n      \"m\": 0,\n      \"gnm\": 79.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 1,\n      \"gnm\": -77,\n      \"hnm\": -48.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 2,\n      \"gnm\": -8.8,\n      \"hnm\": -14.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 7,\n      \"m\": 3,\n      \"gnm\": 59.3,\n      \"hnm\": -1,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.8\n    },\n    {\n      \"n\": 7,\n      \"m\": 4,\n      \"gnm\": 15.8,\n      \"hnm\": 23.4,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 7,\n      \"m\": 5,\n      \"gnm\": 2.5,\n      \"hnm\": -7.4,\n      \"dgnm\": -0.8,\n      \"dhnm\": -1\n    },\n    {\n      \"n\": 7,\n      \"m\": 6,\n      \"gnm\": -11.1,\n      \"hnm\": -25.1,\n      \"dgnm\": -0.8,\n      \"dhnm\": 0.6\n    },\n    {\n      \"n\": 7,\n      \"m\": 7,\n      \"gnm\": 14.2,\n      \"hnm\": -2.3,\n      \"dgnm\": 0.8,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 0,\n      \"gnm\": 23.2,\n      \"hnm\": 0,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 8,\n      \"m\": 1,\n      \"gnm\": 10.8,\n      \"hnm\": 7.1,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 8,\n      \"m\": 2,\n      \"gnm\": -17.5,\n      \"hnm\": -12.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 11.4,\n      \"dgnm\": 0.5,\n      \"dhnm\": -0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 4,\n      \"gnm\": -21.7,\n      \"hnm\": -9.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 8,\n      \"m\": 5,\n      \"gnm\": 16.9,\n      \"hnm\": 12.7,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.5\n    },\n    {\n      \"n\": 8,\n      \"m\": 6,\n      \"gnm\": 15,\n      \"hnm\": 0.7,\n      \"dgnm\": 0.2,\n      \"dhnm\": -0.6\n    },\n    {\n      \"n\": 8,\n      \"m\": 7,\n      \"gnm\": -16.8,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 8,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": 3.9,\n      \"dgnm\": 0.2,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 0,\n      \"gnm\": 4.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 9,\n      \"m\": 1,\n      \"gnm\": 7.8,\n      \"hnm\": -24.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 2,\n      \"gnm\": 3,\n      \"hnm\": 12.2,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 3,\n      \"gnm\": -0.2,\n      \"hnm\": 8.3,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 4,\n      \"gnm\": -2.5,\n      \"hnm\": -3.3,\n      \"dgnm\": -0.3,\n      \"dhnm\": 0.3\n    },\n    {\n      \"n\": 9,\n      \"m\": 5,\n      \"gnm\": -13.1,\n      \"hnm\": -5.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 6,\n      \"gnm\": 2.4,\n      \"hnm\": 7.2,\n      \"dgnm\": 0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 9,\n      \"m\": 7,\n      \"gnm\": 8.6,\n      \"hnm\": -0.6,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 9,\n      \"m\": 8,\n      \"gnm\": -8.7,\n      \"hnm\": 0.8,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0.4\n    },\n    {\n      \"n\": 9,\n      \"m\": 9,\n      \"gnm\": -12.9,\n      \"hnm\": 10,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 0,\n      \"gnm\": -1.3,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 1,\n      \"gnm\": -6.4,\n      \"hnm\": 3.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 2,\n      \"gnm\": 0.2,\n      \"hnm\": 0,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 3,\n      \"gnm\": 2,\n      \"hnm\": 2.4,\n      \"dgnm\": 0.1,\n      \"dhnm\": -0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 4,\n      \"gnm\": -1,\n      \"hnm\": 5.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 5,\n      \"gnm\": -0.6,\n      \"hnm\": -9.1,\n      \"dgnm\": -0.3,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 6,\n      \"gnm\": -0.9,\n      \"hnm\": 0.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 7,\n      \"gnm\": 1.5,\n      \"hnm\": -4.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 10,\n      \"m\": 8,\n      \"gnm\": 0.9,\n      \"hnm\": -3.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 10,\n      \"m\": 9,\n      \"gnm\": -2.7,\n      \"hnm\": 0.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.2\n    },\n    {\n      \"n\": 10,\n      \"m\": 10,\n      \"gnm\": -3.9,\n      \"hnm\": -9.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 0,\n      \"gnm\": 2.9,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 1,\n      \"gnm\": -1.5,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 2,\n      \"gnm\": -2.5,\n      \"hnm\": 2.9,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 3,\n      \"gnm\": 2.4,\n      \"hnm\": -0.6,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 4,\n      \"gnm\": -0.6,\n      \"hnm\": 0.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 5,\n      \"gnm\": -0.1,\n      \"hnm\": 0.5,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 6,\n      \"gnm\": -0.6,\n      \"hnm\": -0.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 7,\n      \"gnm\": -0.1,\n      \"hnm\": -1.2,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 11,\n      \"m\": 8,\n      \"gnm\": 1.1,\n      \"hnm\": -1.7,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 9,\n      \"gnm\": -1,\n      \"hnm\": -2.9,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1.8,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 11,\n      \"m\": 11,\n      \"gnm\": 2.6,\n      \"hnm\": -2.3,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 0,\n      \"gnm\": -2,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 1,\n      \"gnm\": -0.2,\n      \"hnm\": -1.3,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 2,\n      \"gnm\": 0.3,\n      \"hnm\": 0.7,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 3,\n      \"gnm\": 1.2,\n      \"hnm\": 1,\n      \"dgnm\": 0,\n      \"dhnm\": -0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 4,\n      \"gnm\": -1.3,\n      \"hnm\": -1.4,\n      \"dgnm\": 0,\n      \"dhnm\": 0.1\n    },\n    {\n      \"n\": 12,\n      \"m\": 5,\n      \"gnm\": 0.6,\n      \"hnm\": 0,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 6,\n      \"gnm\": 0.6,\n      \"hnm\": 0.6,\n      \"dgnm\": 0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 7,\n      \"gnm\": 0.5,\n      \"hnm\": -0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 8,\n      \"gnm\": -0.1,\n      \"hnm\": 0.8,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 9,\n      \"gnm\": -0.4,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 10,\n      \"gnm\": -0.2,\n      \"hnm\": -1,\n      \"dgnm\": -0.1,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 11,\n      \"gnm\": -1.3,\n      \"hnm\": 0.1,\n      \"dgnm\": 0,\n      \"dhnm\": 0\n    },\n    {\n      \"n\": 12,\n      \"m\": 12,\n      \"gnm\": -0.7,\n      \"hnm\": 0.2,\n      \"dgnm\": -0.1,\n      \"dhnm\": -0.1\n    }\n  ]\n};","import dom from './dom.js';\r\nimport geomag from './geomag.js';\r\n\r\nconst getLocation = () => {\r\n  const promise = new Promise((resolve, reject) => {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      const { declination } = geomag(location.coords);\r\n      location.declination = declination;\r\n      resolve(location);\r\n    },\r\n    () => resolve());\r\n  });\r\n\r\n  return promise;\r\n}\r\n\r\nconst initialize = async (state) => {\r\n  const permission = await navigator.permissions.query({ name: 'geolocation' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return 'Permission to use this device\\'s location was denied';\r\n  }\r\n\r\n  let location = await getLocation();\r\n\r\n  if (!location) {\r\n    return 'Could not get a location for this device';\r\n  }\r\n\r\n  state.location = location;\r\n  let intervalHandle;\r\n\r\n  const visibilityChangeHandler = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!intervalHandle) {\r\n        intervalHandle = setInterval(async () => {\r\n          location = await getLocation();\r\n\r\n          if (location) {\r\n            state.location = location;\r\n          }\r\n        }, 1000);\r\n      }\r\n    }\r\n    else {\r\n      if (intervalHandle) {\r\n        clearInterval(intervalHandle);\r\n        intervalHandle = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n}\r\n\r\nexport default { initialize };","import angle from './angle.js'\r\n\r\nconst cosSin = (a) => {\r\n  const θ = angle.rad(a);\r\n  return {\r\n    cosθ: Math.cos(θ),\r\n    sinθ: Math.sin(θ)\r\n  }\r\n}\r\n\r\nexport const identity = () => [\r\n  [1, 0, 0],\r\n  [0, 1, 0],\r\n  [0, 0, 1]\r\n];\r\n\r\nexport const xRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [1, 0, 0],\r\n    [0, cosθ, -sinθ],\r\n    [0, sinθ, cosθ]\r\n  ]\r\n};\r\n\r\nexport const yRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, 0, sinθ],\r\n    [0, 1, 0],\r\n    [-sinθ, 0, cosθ]\r\n  ]\r\n};\r\n\r\nexport const zRotation = (a) => {\r\n  const { cosθ, sinθ } = cosSin(a);\r\n  return [\r\n    [cosθ, -sinθ, 0],\r\n    [sinθ, cosθ, 0],\r\n    [0, 0, 1]\r\n  ]\r\n};\r\n\r\nexport const multiply = (...matrices) => {\r\n  let a = matrices[0];\r\n  let c;\r\n\r\n  for (let n = 1; n < matrices.length; n++) {\r\n    const b = matrices[n];\r\n    c = [[], [], []];\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      for (let j = 0; j < 3; j++) {\r\n        c[i][j] = a[i][0] * b[0][j] + a[i][1] * b[1][j] + a[i][2] * b[2][j];\r\n      }\r\n    }\r\n\r\n    a = c;\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport const vectorMultiply = (m, v) => {\r\n  const [ x, y, z ] = v;\r\n  const w = [];\r\n\r\n  for (let i = 0; i < 3; i++) {\r\n    w[i] = m[i][0] * x + m[i][1] * y + m[i][2] * z;\r\n  }\r\n\r\n  return w;\r\n};\r\n\r\nexport const inverse = (m) => {\r\n  const [ a, b, c ] = m[0];\r\n  const [ d, e, f ] = m[1];\r\n  const [ g, h, i ] = m[2];\r\n\r\n  const a1 = e * i - f * h;\r\n  const b1 = -(d * i - f * g);\r\n  const c1 = d * h - e * g;\r\n  const d1 = -(b * i - c * h);\r\n  const e1 = a * i - c * g;\r\n  const f1 = -(a * h - b * g);\r\n  const g1 = b * f - c * e;\r\n  const h1 = -(a * f - c * d);\r\n  const i1 = a * e - b * d;\r\n\r\n  const det = a * a1 + b * b1 + c * c1;\r\n  \r\n  return [\r\n    [a1 / det, d1 / det, g1 / det],\r\n    [b1 / det, e1 / det, h1 / det],\r\n    [c1 / det, f1 / det, i1 / det]\r\n  ];\r\n}\r\n\r\nexport default { identity, xRotation, yRotation, zRotation, multiply, vectorMultiply, inverse };\r\n","import { deg, rev } from './angle.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\nimport dom from './dom.js';\r\n\r\nconst { atan2, abs, sign, asin } = Math;\r\nconst HALF_PI = Math.PI * 0.5;\r\n\r\nconst initialize = (state) => {\r\n  if (!AbsoluteOrientationSensor) {\r\n    return 'Orientation sensor is not supported on this device';\r\n  }\r\n\r\n  const sensor = new AbsoluteOrientationSensor({ frequency: 30 });\r\n  sensor.onreading = () => {\r\n    if (!state.location) {\r\n      return;\r\n    }\r\n\r\n    const [qx, qy, qz, qw] = sensor.quaternion;\r\n\r\n    // https://en.wikipedia.org/wiki/Conversion_between_quaternions_and_Euler_angles\r\n\r\n    const xy = 2 * (qw * qx + qy * qz);\r\n    const xx = 1 - 2 * (qx * qx + qy * qy);\r\n    const xr = deg(atan2(xy, xx));\r\n\r\n    const ysin = 2 * (qw * qy - qz * qx);\r\n    let yr = deg(abs(ysin > 1) ? sign(ysin) * HALF_PI : asin(ysin));\r\n\r\n    const zy = 2 * (qw * qz + qx * qy);\r\n    const zx = 1 - 2 * (qy * qy + qz * qz);\r\n    let zr = deg(atan2(zy, zx));\r\n\r\n    // adjust for viewing\r\n\r\n    yr = 360 - yr;\r\n    zr = rev(zr - 90 - state.location.declination);\r\n\r\n    state.rotationMatrix = matrix.multiply(matrix.xRotation(xr), matrix.yRotation(yr), matrix.zRotation(zr));\r\n  };\r\n\r\n  sensor.start();\r\n\r\n  const visibilityChangeHandler = () => {\r\n    if (document.visibilityState === 'visible') {\r\n      sensor.start();\r\n    }\r\n    else {\r\n      sensor.stop();\r\n    }\r\n  };\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","import angle from './angle.js'\r\n\r\nconst { rad, deg, rev } = angle;\r\nconst { cos, sin, atan2 } = Math;\r\n\r\nexport const toRectangular = (c) => {\r\n  let [ λ, φ ] = c;\r\n  λ = rad(λ);\r\n  φ = rad(φ);\r\n\r\n  const cosφ = cos(φ);\r\n\r\n  return [\r\n    cos(λ) * cosφ,\r\n    sin(λ) * cosφ,\r\n    sin(φ)\r\n  ];\r\n};\r\n\r\nexport const toPolar = (c) => {\r\n  const [ x, y, z ] = c;\r\n  return [\r\n    rev(deg(atan2(y, x))),\r\n    deg(atan2(z, Math.sqrt(x * x + y * y)))\r\n  ];\r\n};\r\n\r\nexport default { toRectangular, toPolar }\r\n","\r\nconst project = (c) => {\r\n  const [ x, y, z ] = c;\r\n  const factor = 1 - z;\r\n  return [\r\n    x / factor,\r\n    y / factor\r\n  ];\r\n};\r\n\r\nconst unproject = (c) => {\r\n  const [ x, y ] = c;\r\n  const x2y2 = x * x + y * y;\r\n  const factor = x2y2 + 1;\r\n  return [\r\n    2 * x / factor,\r\n    2 * y / factor,\r\n    (x2y2 - 1) / factor\r\n  ];\r\n};\r\n\r\nexport default { project, unproject }\r\n\r\n","import { toRectangular, toPolar } from './coordinate-conversion.js';\r\nimport projection from './stereographic-projection.js';\r\nimport matrix from './3d-rotation-matrix.js';\r\n\r\nconst createTransformer = (ctx, state) => {\r\n  const { rotationMatrix, scale } = state;\r\n\r\n  const xOffset = ctx.canvas.clientWidth * 0.5;\r\n  const yOffset = ctx.canvas.clientHeight * 0.5;\r\n  const inverseRotationMatrix = matrix.inverse(rotationMatrix);\r\n\r\n  const rectangularToScreen = (c) => {\r\n    const c1 = matrix.vectorMultiply(rotationMatrix, c);\r\n    const [ x, y ] = projection.project(c1);\r\n    return [\r\n      x * scale + xOffset,\r\n      y * scale + yOffset\r\n    ];\r\n  }\r\n\r\n  const polarToScreen = (c) => rectangularToScreen(toRectangular(c));\r\n  \r\n  const screenToRectangular = (c) => {\r\n    const [ x, y ] = c;\r\n    const c1 = projection.unproject([\r\n      (x - xOffset) / scale,\r\n      (y - yOffset) / scale\r\n    ]);\r\n    return matrix.vectorMultiply(inverseRotationMatrix, c1);\r\n  }\r\n\r\n  const screenToPolar = (c) => toPolar(screenToRectangular(c));\r\n\r\n  return { polarToScreen, rectangularToScreen, screenToRectangular, screenToPolar };\r\n};\r\n\r\nexport default createTransformer;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\n\r\nconst graticule = [];\r\n\r\n// major longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 90) {\r\n  const coordinates = [];\r\n\r\n  for (let lat = -90; lat <= 90; lat++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\n// minor longitudes\r\n\r\nfor (let lon = 0; lon < 360; lon += 15) {\r\n  if (lon % 90 > 0) {\r\n    const coordinates = [];\r\n\r\n    for (let lat = -75; lat <= 75; lat++) {\r\n      coordinates.push(toRectangular([lon, lat]));\r\n    }\r\n\r\n    graticule.push(coordinates);\r\n  }\r\n}\r\n\r\n// latitudes\r\n\r\nfor (let lat = -75; lat <= 75; lat += 15) {\r\n  const coordinates = [];\r\n\r\n  for (let lon = 0; lon <= 360; lon++) {\r\n    coordinates.push(toRectangular([lon, lat]));\r\n  }\r\n\r\n  graticule.push(coordinates);\r\n}\r\n\r\nconst overlayGraticule = (ctx, state) => {\r\n  const { rectangularToScreen } = createTransformer(ctx, state);\r\n\r\n  ctx.save();\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.shadowBlur = 0;\r\n\r\n  graticule.forEach((coordinates) => {\r\n    coordinates = coordinates.map((c) => rectangularToScreen(c))\r\n    \r\n    ctx.beginPath();\r\n    ctx.moveTo(...coordinates[0]);\r\n\r\n    for (let i = 1; i < coordinates.length; i++) {\r\n      ctx.lineTo(...coordinates[i]);\r\n    }\r\n\r\n    ctx.stroke();    \r\n  });\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayGraticule;","\r\nconst drawRotatedText = (ctx, text, origin, rotation, offset = [0, 0]) => {\r\n  ctx.save();\r\n  ctx.translate(...origin);\r\n  ctx.rotate(rotation);\r\n  ctx.fillText(text, ...offset);\r\n  ctx.restore();\r\n}\r\n\r\nexport default drawRotatedText;","import { toRectangular } from './coordinate-conversion.js';\r\nimport createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\n\r\nconst { atan2 } = Math;\r\n\r\nconst baseHorizon = [];\r\nconst baseN45 = [];\r\nconst baseS45 = [];\r\nconst direction = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];\r\n\r\nfor (let lon = 0; lon < 360; lon++) {\r\n  baseHorizon.push(toRectangular([lon, 0]));\r\n}\r\n\r\nbaseHorizon.push(baseHorizon[0]);\r\n\r\nfor (let lon = 0; lon < 360; lon += 45) {\r\n  baseN45.push(toRectangular([lon, 45.5]));\r\n  baseN45.push(toRectangular([lon, 45]));\r\n  baseS45.push(toRectangular([lon, -44.5]));\r\n  baseS45.push(toRectangular([lon, -45]));\r\n}\r\n\r\nconst overlayAzimuth = (ctx, state) => {\r\n  const { rectangularToScreen } = createTransformer(ctx, state);\r\n\r\n  const horizon = baseHorizon.map(rectangularToScreen);\r\n  const n45 = baseN45.map(rectangularToScreen);\r\n  const s45 = baseS45.map(rectangularToScreen);\r\n\r\n  ctx.save();\r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  for (let lon = 0; lon < 360; lon++) {\r\n    let [ x0, y0 ] = horizon[lon];\r\n    let [ x1, y1 ] = horizon[lon + 1];\r\n    let dx = x1 - x0;\r\n    let dy = y1 - y0;\r\n\r\n    const major = lon % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n    \r\n    if (major) {\r\n      ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'top';\r\n\r\n      const offset = 1.5;\r\n      let rotation = atan2(dy, dx);\r\n      let tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${lon}`, tc, rotation);\r\n\r\n      if (lon % 45 === 0) {\r\n        ctx.font = \"bold 24px Arial, Helvetica, sans-serif\";\r\n        ctx.textBaseline = 'bottom';\r\n\r\n        const i = lon / 45;\r\n        const text = `${direction[i]}`;\r\n\r\n        tc = [x0 + dy * offset, y0 - dx * offset];\r\n        drawRotatedText(ctx, text, tc, rotation);\r\n\r\n        [ x0, y0 ] = n45[i * 2];\r\n        [ x1, y1 ] = n45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n\r\n        [ x0, y0 ] = s45[i * 2];\r\n        [ x1, y1 ] = s45[i * 2 + 1];\r\n        dx = x1 - x0;\r\n        dy = y1 - y0;\r\n\r\n        drawRotatedText(ctx, text, [x0, y0], atan2(-dx, dy));\r\n      }\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayAzimuth;","import createTransformer from './create-transformer.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\n\r\nconst { atan2, abs } = Math;\r\n\r\nconst overlayAltitude = (ctx, state) => {\r\n  const { polarToScreen, screenToPolar } = createTransformer(ctx, state);\r\n\r\n  const [ longitude ] = screenToPolar([ ctx.canvas.width * 0.5, ctx.canvas.height * 0.5 ]);\r\n  const altitude = [];\r\n\r\n  for (let lat = -90; lat <= 90; lat++) {\r\n    altitude.push(polarToScreen([longitude, lat]));\r\n  }\r\n  \r\n  ctx.save();\r\n\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeStyle = '#ffffff30';\r\n  ctx.beginPath();\r\n  ctx.moveTo(...altitude[0]);\r\n\r\n  for (let i = 1; i < altitude.length; i++) {\r\n    ctx.lineTo(...altitude[i]);\r\n  }\r\n\r\n  ctx.stroke();    \r\n\r\n  ctx.strokeStyle = '#ffffffd0';\r\n  ctx.fillStyle = '#ffffffd0';\r\n  ctx.shadowBlur = 5;\r\n  ctx.shadowColor = '#000000';\r\n\r\n  ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n  ctx.textAlign = 'left';\r\n  ctx.textBaseline = 'middle';\r\n\r\n  for (let lat = -89, i = 1; lat <= 89; lat++, i++) {\r\n    const [ x0, y0 ] = altitude[i];\r\n    const [ x1, y1 ] = altitude[i - 1];\r\n    const dx = x0 - x1;\r\n    const dy = y0 - y1;\r\n\r\n    const major = lat % 5 === 0;\r\n    const len = major ? 1 : 0.5;\r\n\r\n    ctx.beginPath();\r\n    ctx.moveTo(x0 + dy * len, y0 - dx * len);\r\n    ctx.lineTo(x0 - dy * len, y0 + dx * len);\r\n    ctx.stroke();\r\n\r\n    if (major && lat) {\r\n      const offset = 1.5;\r\n      const rotation = atan2(dx, -dy);\r\n      const tc = [x0 - dy * offset, y0 + dx * offset];\r\n      drawRotatedText(ctx, `${abs(lat)}`, tc, rotation);\r\n    }\r\n  }\r\n\r\n  ctx.restore();\r\n};\r\n\r\nexport default overlayAltitude;","// sources\r\n//   https://en.wikipedia.org/wiki/Great-circle_distance, first formula, spherical law of cosines\r\n//   https://en.wikipedia.org/wiki/Azimuth#In_geodesy\r\n\r\nimport { deg, rad, rev } from './angle.js';\r\n\r\nconst { abs, cos, sin, tan, acos, atan2, PI } = Math;\r\n\r\nconst radius = 6371008.8;\r\nconst EPSILON = 0.000000001;  // radians\r\n\r\nconst distanceAzimuth = (p1, p2) => {\r\n  const { longitude: lon1, latitude: lat1 } = p1;\r\n  const { longitude: lon2, latitude: lat2 } = p2;\r\n\r\n  const λ1 = rad(lon1);\r\n  const φ1 = rad(lat1);\r\n  const λ2 = rad(lon2);\r\n  const φ2 = rad(lat2);\r\n  const Δλ = λ2 - λ1;\r\n\r\n  const coincident = abs(Δλ) < EPSILON && abs(φ2 - φ1) < EPSILON;\r\n  const antipodal = !coincident && abs(abs(Δλ) - PI) < EPSILON && abs(φ1 + φ2) < EPSILON;\r\n\r\n  if (coincident || antipodal) {\r\n    return {};\r\n  }\r\n\r\n  const cosφ1 = cos(φ1);\r\n  const sinφ1 = sin(φ1);\r\n  const cosφ2 = cos(φ2);\r\n  const sinφ2 = sin(φ2);\r\n  const tanφ2 = tan(φ2);\r\n  const cosΔλ = cos(Δλ);\r\n  const sinΔλ = sin(Δλ);\r\n\r\n  const distance = radius * acos(sinφ1 * sinφ2 + cosφ1 * cosφ2 *  cosΔλ);\r\n  const azimuth = rev(deg(atan2(sinΔλ, cosφ1 * tanφ2 - sinφ1 * cosΔλ)));\r\n\r\n  return { distance, azimuth };\r\n};\r\n\r\nexport default distanceAzimuth;\r\n","import createTransformer from './create-transformer.js';\r\nimport distanceAzimuth from './distance-azimuth-sphere.js';\r\nimport drawRotatedText from './draw-rotated-text.js';\r\nimport { deg } from './angle.js';\r\n\r\nconst { sqrt, atan2, PI } = Math;\r\n\r\nconst MIN_DISTANCE = 20;  // meters; mark must be beyond this distance to be visible\r\nconst MAX_ALTITUDE_DISTANCE = 50000;  // meters; mark must be within this distance to be plotted with an altitude\r\nconst METERS_PER_FOOT = 0.3048;\r\nconst METERS_PER_MILE = 5280 * METERS_PER_FOOT;\r\n\r\nconst overlayMarks = (ctx, state) => {\r\n  const marks = state.marks.filter((m) => m.visible);\r\n\r\n  if (!marks.length) {\r\n    return;\r\n  }\r\n\r\n  const { polarToScreen } = createTransformer(ctx, state);\r\n\r\n  ctx.save();\r\n\r\n  ctx.font = \"bold 16px Arial, Helvetica, sans-serif\";\r\n  ctx.textAlign = 'left';\r\n  ctx.textBaseline = 'bottom';\r\n  ctx.shadowColor = '#000000';\r\n\r\n  marks.forEach((m) => {\r\n    const { coords } = state.location;\r\n    let { distance, azimuth } = distanceAzimuth(coords, m);\r\n\r\n    if (distance && distance >= MIN_DISTANCE) {\r\n      let altitude = 0;\r\n\r\n      if (m.elevation !== undefined && distance <= MAX_ALTITUDE_DISTANCE) {\r\n        const Δelevation = m.elevation - coords.altitude;\r\n        altitude = deg(atan2(Δelevation, distance));\r\n        distance = sqrt(distance * distance + Δelevation * Δelevation);\r\n      }\r\n\r\n      const [ x0, y0 ] = polarToScreen([azimuth, altitude]);\r\n      const [ x1, y1 ] = polarToScreen([azimuth + 1, altitude]);\r\n\r\n      ctx.save();\r\n\r\n      ctx.fillStyle = '#ff404080';\r\n      ctx.strokeStyle = '#ffffff';\r\n      ctx.shadowBlur = 0;\r\n      ctx.beginPath();\r\n      ctx.arc(x0, y0, 10, 0, 2 * PI);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n\r\n      const customary = distance < METERS_PER_MILE ? `${(distance / METERS_PER_FOOT).toFixed(0)} ft` : `${(distance / METERS_PER_MILE).toFixed(1)} mi`;\r\n      const metric = distance < 1000 ? `${distance.toFixed(0)} m` : `${(distance * 0.001).toFixed(1)} km`;\r\n\r\n      const dx = x1 - x0;\r\n      const dy = y1 - y0;\r\n      const rotation = atan2(dy, dx);\r\n\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.shadowBlur = 5;\r\n\r\n      drawRotatedText(ctx, `${m.name} ${customary} ${metric}`, [x0, y0], rotation, [12, 0]);\r\n\r\n      ctx.restore();\r\n    }\r\n  });\r\n};\r\n\r\nexport default overlayMarks;","import overlayGraticule from './overlay-graticule.js';\r\nimport overlayAzimuth from './overlay-azimuth.js';\r\nimport overlayAltitude from './overlay-altitude.js';\r\nimport overlayMarks from './overlay-marks.js';\r\nimport dom from './dom.js';\r\n\r\nconst FRAMES_PER_SECOND = 30;\r\n\r\nconst initialize = (state) => {\r\n  const canvas = document.querySelector('canvas');\r\n  canvas.width = window.innerWidth;\r\n  canvas.height = window.innerHeight;\r\n\r\n  const ctx = canvas.getContext('2d');\r\n  const fpsInterval = 1000 / FRAMES_PER_SECOND;\r\n\r\n  let animationFrameHandle;\r\n  let lastUpdated = performance.now();\r\n\r\n  const update = () => {\r\n    animationFrameHandle = requestAnimationFrame(update);\r\n    \r\n    const now = performance.now();\r\n    const elapsed = now - lastUpdated;\r\n\r\n    if (elapsed < fpsInterval) {\r\n      return;\r\n    }\r\n\r\n    if (state.rotationMatrix) {\r\n      ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);\r\n      overlayGraticule(ctx, state);\r\n      overlayAltitude(ctx, state);\r\n      overlayAzimuth(ctx, state);\r\n      overlayMarks(ctx, state);\r\n    }\r\n\r\n    lastUpdated = now;\r\n  };\r\n\r\n  update();\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (animationFrameHandle === undefined) {\r\n        lastUpdated = performance.now();\r\n        update();\r\n      }\r\n    }\r\n    else {\r\n      if (animationFrameHandle !== undefined) {\r\n        cancelAnimationFrame(animationFrameHandle);\r\n        animationFrameHandle = undefined;\r\n      }\r\n    }\r\n  };\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n};\r\n\r\nexport default { initialize };\r\n","import dom from './dom.js';\r\n\r\nconst initialize = async (state) => {\r\n  const permission = await navigator.permissions.query({ name: 'screen-wake-lock' });\r\n\r\n  if (permission.state === 'denied') {\r\n    return;\r\n  }\r\n\r\n  let wakeLock;\r\n\r\n  const visibilityChangeHandler = async () => {\r\n    if (document.visibilityState === 'visible') {\r\n      if (!wakeLock) {\r\n        wakeLock = await navigator.wakeLock.request('screen');\r\n        wakeLock.addEventListener('release', () => {\r\n          wakeLock = undefined;\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      if (wakeLock) {\r\n        wakeLock.release();\r\n      }\r\n    }\r\n  };\r\n  \r\n  await visibilityChangeHandler();\r\n\r\n  dom.on(document, 'visibilitychange', visibilityChangeHandler);\r\n}\r\n\r\nexport default { initialize };\r\n","import dom from './dom.js';\r\n\r\nlet state;\r\n\r\nconst $mark = dom.get('mark');\r\nconst $dialog = dom.get('mark-modal');\r\nconst $form = dom.get('mark-form');\r\nconst $name = dom.get('mark-name');\r\nconst $lat = dom.get('mark-lat');\r\nconst $lon = dom.get('mark-lon');\r\nconst $elev = dom.get('mark-elev');\r\nconst $ok = dom.get('mark-ok');\r\nconst $cancel = dom.get('mark-cancel');\r\n\r\ndom.on($mark, 'click', () => {\r\n  const { coords } = state.location;\r\n  $name.value = '';\r\n  $lat.value = coords.latitude.toFixed(6);\r\n  $lon.value = coords.longitude.toFixed(6);\r\n  $elev.value = coords.altitude.toFixed(0);\r\n  $dialog.showModal();\r\n});\r\n\r\ndom.on($ok, 'click', () => {\r\n  if (!$form.checkValidity()) {\r\n    return;\r\n  }\r\n\r\n  const name = $name.value;\r\n  const latitude = parseFloat($lat.value);\r\n  const longitude = parseFloat($lon.value);\r\n  const elevation = $elev.value ? parseFloat($elev.value) : undefined;\r\n\r\n  const { marks } = state;\r\n  let mark = marks.find((m) => m.name.toLowerCase() === name.toLowerCase());\r\n\r\n  if (!mark) {\r\n    mark = {};\r\n    marks.push(mark);\r\n  }\r\n\r\n  Object.assign(mark, { name, latitude, longitude, elevation, visible: true });\r\n  $dialog.close();\r\n});\r\n\r\ndom.on($cancel, 'click', () => $dialog.close());\r\n\r\ndom.on($dialog, 'click', (event) => {\r\n  if (event.target === $dialog) {\r\n    $dialog.close();\r\n  }\r\n});\r\n\r\nconst initialize = (inState) => {\r\n  state = inState;\r\n};\r\n\r\nexport default { initialize };","import dom from './dom.js';\r\nimport video from './video.js';\r\nimport location from './location.js';\r\nimport orientation from './orientation.js';\r\nimport overlay from './overlay.js';\r\nimport wakeLock from './wake-lock.js';\r\nimport markManager from './mark-manager.js';\r\n\r\n(async () => {\r\n  const state = { scale: 1500, marks: [] };\r\n\r\n  const $init = dom.find('#init')[0];\r\n  $init.style.setProperty('display', 'block');  \r\n\r\n  // initialize the video from the device's front-facing camera\r\n\r\n  $init.innerHTML = 'Starting camera and video ...';\r\n\r\n  let error = await video.initialize();\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the user's location including magentic declination\r\n  \r\n  $init.innerHTML = 'Getting device location, please wait ...';\r\n\r\n  error = await location.initialize(state);\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the orientation sensor\r\n\r\n  error = orientation.initialize(state);\r\n\r\n  if (error) {\r\n    $init.innerHTML = error;\r\n    return;\r\n  }\r\n\r\n  // initialize the overlay\r\n\r\n  $init.style.setProperty('display', 'none');\r\n\r\n  overlay.initialize(state);\r\n  \r\n  // initialize wake lock: keep screen active while in use\r\n\r\n  wakeLock.initialize();\r\n\r\n  // initialize the mark manager\r\n\r\n  markManager.initialize(state);\r\n})();\r\n"],"names":["toArray","target","Array","HTMLElement","HTMLDocument","HTMLCollection","from","add","children","elements","Error","forEach","c","appendChild","each","action","e","isContent","x","constructor","name","dom","tagName","args","element","document","createElement","properties","find","a","Object","assign","content","innerHTML","selector","pop","length","querySelectorAll","id","getElementById","type","handler","addEventListener","videoOptions","video","facingMode","exact","width","ideal","window","innerHeight","height","innerWidth","getVideoStream","async","stream","navigator","mediaDevices","getUserMedia","permissions","query","state","$videoContainer","$video","visibilityChangeHandler","visibilityState","autoplay","mute","srcObject","getTracks","t","stop","remove","undefined","radiansPerDegree","Math","PI","degreesPerRadian","rad","deg","rev","angle","array","n","v","isFunction","Function","i","sqrt","sin","cos","atan2","abs","cd","tc","dp","snorm","sp","cp","fn","fm","pp","k","p","b","a2","b2","c2","a4","c4","epoch","model","m","gnm","hnm","dgnm","dhnm","coefficients","j","D2","flnmj","geomag","location","date","latitude","glat","longitude","glon","altitude","alt","year","Date","getUTCFullYear","msInYear","valueOf","UTC","decimalYear","dt","rlat","rlon","srlon","srlat","crlon","crlat","srlat2","crlat2","q","q1","ct","st","r","d","ca","sa","aor","ar","br","bt","bp","bpp","D4","par","temp1","temp2","parp","bx","by","bz","bh","ti","dec","dip","gv","declination","inclination","intensity","gridVariation","getLocation","promise","Promise","resolve","reject","geolocation","getCurrentPosition","coords","intervalHandle","setInterval","clearInterval","cosSin","matrix","matrices","y","z","w","f","g","h","a1","b1","c1","det","sign","asin","HALF_PI","orientation","AbsoluteOrientationSensor","sensor","frequency","onreading","qx","qy","qz","qw","quaternion","xr","ysin","yr","zr","rotationMatrix","start","toRectangular","projection","factor","x2y2","createTransformer","ctx","scale","xOffset","canvas","clientWidth","yOffset","clientHeight","inverseRotationMatrix","rectangularToScreen","screenToRectangular","polarToScreen","screenToPolar","toPolar","graticule","lon","coordinates","lat","push","drawRotatedText","text","origin","rotation","offset","save","translate","rotate","fillText","restore","baseHorizon","baseN45","baseS45","direction","tan","acos","EPSILON","METERS_PER_FOOT","METERS_PER_MILE","overlayMarks","marks","filter","visible","font","textAlign","textBaseline","shadowColor","distance","azimuth","p1","p2","lon1","lat1","lon2","lat2","coincident","antipodal","distanceAzimuth","elevation","x0","y0","x1","y1","fillStyle","strokeStyle","shadowBlur","beginPath","arc","fill","stroke","customary","toFixed","metric","overlay","querySelector","getContext","fpsInterval","animationFrameHandle","lastUpdated","performance","now","update","requestAnimationFrame","clearRect","lineWidth","map","moveTo","lineTo","overlayGraticule","dx","dy","major","len","overlayAltitude","horizon","n45","s45","overlayAzimuth","cancelAnimationFrame","wakeLock","request","release","$mark","$dialog","$form","$name","$lat","$lon","$elev","$ok","$cancel","value","showModal","checkValidity","parseFloat","mark","toLowerCase","close","event","markManager","inState","$init","style","setProperty","error"],"mappings":"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"}